"use strict";(self.webpackChunkdoc_hub=self.webpackChunkdoc_hub||[]).push([[9510],{8048:(e,n,s)=>{s.r(n),s.d(n,{assets:()=>t,contentTitle:()=>d,default:()=>h,frontMatter:()=>l,metadata:()=>r,toc:()=>a});const r=JSON.parse('{"id":"CloudNative/Orchestration/K8s/\u5b89\u88c5K8s/\u5b89\u88c5K8s","title":"\u5b89\u88c5 K8s","description":"\u5b89\u88c5 K8s","source":"@site/docs/CloudNative/Orchestration/K8s/\u5b89\u88c5K8s/\u5b89\u88c5K8s.md","sourceDirName":"CloudNative/Orchestration/K8s/\u5b89\u88c5K8s","slug":"/cloud-native/orchestration/install-k8s","permalink":"/docs/cloud-native/orchestration/install-k8s","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/CloudNative/Orchestration/K8s/\u5b89\u88c5K8s/\u5b89\u88c5K8s.md","tags":[{"inline":true,"label":"K8s","permalink":"/docs/tags/k-8-s"},{"inline":true,"label":"CloudNative","permalink":"/docs/tags/cloud-native"}],"version":"current","frontMatter":{"title":"\u5b89\u88c5 K8s","description":"\u5b89\u88c5 K8s","slug":"/cloud-native/orchestration/install-k8s","hide_table_of_contents":false,"keywords":["K8s"],"tags":["K8s","CloudNative"],"date":"2017-08-01T00:00:00.000Z","categories":["Orchestration"]},"sidebar":"orchestrationSidebar","next":{"title":"\u5b89\u88c5 K3s","permalink":"/docs/cloud-native/orchestration/install-k3s"}}');var c=s(74848),i=s(28453);const l={title:"\u5b89\u88c5 K8s",description:"\u5b89\u88c5 K8s",slug:"/cloud-native/orchestration/install-k8s",hide_table_of_contents:!1,keywords:["K8s"],tags:["K8s","CloudNative"],date:new Date("2017-08-01T00:00:00.000Z"),categories:["Orchestration"]},d="\u5b89\u88c5 K8s",t={},a=[{value:"1.\u96c6\u7fa4\u89c4\u5212",id:"1\u96c6\u7fa4\u89c4\u5212",level:2},{value:"1.1 \u673a\u5668\u73af\u5883",id:"11-\u673a\u5668\u73af\u5883",level:3},{value:"1.2 \u8f6f\u4ef6\u73af\u5883",id:"12-\u8f6f\u4ef6\u73af\u5883",level:3},{value:"2. \u524d\u7f6e\u51c6\u5907 (\u6240\u6709\u8282\u70b9)",id:"2-\u524d\u7f6e\u51c6\u5907-\u6240\u6709\u8282\u70b9",level:2},{value:"2.1 \u7981\u7528 selinux",id:"21-\u7981\u7528-selinux",level:3},{value:"2.2 \u7981\u7528 swap",id:"22-\u7981\u7528-swap",level:3},{value:"2.3 \u7981\u7528\u9632\u706b\u5899",id:"23-\u7981\u7528\u9632\u706b\u5899",level:3},{value:"2.4 \u5347\u7ea7\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838(\u975e\u5fc5\u9700)",id:"24-\u5347\u7ea7\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u975e\u5fc5\u9700",level:3},{value:"2.5 \u8bbe\u7f6e nameserver",id:"25-\u8bbe\u7f6e-nameserver",level:3},{value:"2.6 \u8bbe\u7f6e hosts",id:"26-\u8bbe\u7f6e-hosts",level:3},{value:"2.7 \u8bbe\u7f6e\u4e3b\u673a\u540d",id:"27-\u8bbe\u7f6e\u4e3b\u673a\u540d",level:3},{value:"2.8 \u8bbe\u7f6e\u65f6\u95f4\u540c\u6b65",id:"28-\u8bbe\u7f6e\u65f6\u95f4\u540c\u6b65",level:3},{value:"2.9 \u5185\u6838\u53c2\u6570\u8c03\u6574",id:"29-\u5185\u6838\u53c2\u6570\u8c03\u6574",level:3},{value:"2.10 \u96c6\u7fa4\u514d\u5bc6\u767b\u9646",id:"210-\u96c6\u7fa4\u514d\u5bc6\u767b\u9646",level:3},{value:"2.11 \u914d\u7f6e ipvs \u529f\u80fd",id:"211-\u914d\u7f6e-ipvs-\u529f\u80fd",level:3},{value:"3. \u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6 (\u6240\u6709\u8282\u70b9)",id:"3-\u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6-\u6240\u6709\u8282\u70b9",level:2},{value:"3.1 containerd",id:"31-containerd",level:3},{value:"3.1.1 \u5b89\u88c5 containerd",id:"311-\u5b89\u88c5-containerd",level:4},{value:"3.1.2 \u751f\u6210 config.toml \u914d\u7f6e",id:"312-\u751f\u6210-configtoml-\u914d\u7f6e",level:4},{value:"3.1.3 \u914d\u7f6e systemd cgroup",id:"313-\u914d\u7f6e-systemd-cgroup",level:4},{value:"3.1.4 \u542f\u52a8 containerd \u5e76\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8",id:"314-\u542f\u52a8-containerd-\u5e76\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8",level:4},{value:"3.1.5 \u914d\u7f6e\u5ba2\u6237\u7aef\u5de5\u5177",id:"315-\u914d\u7f6e\u5ba2\u6237\u7aef\u5de5\u5177",level:4},{value:"4. K8s \u670d\u52a1\u5b89\u88c5",id:"4-k8s-\u670d\u52a1\u5b89\u88c5",level:2},{value:"4.1 k8s \u914d\u7f6e\u963f\u91cc\u4e91 yum \u6e90 (\u6240\u6709\u8282\u70b9)",id:"41-k8s-\u914d\u7f6e\u963f\u91cc\u4e91-yum-\u6e90-\u6240\u6709\u8282\u70b9",level:3},{value:"4.2 kubeadm&amp;kubelet&amp;kubectl (\u6240\u6709\u8282\u70b9)",id:"42-kubeadmkubeletkubectl-\u6240\u6709\u8282\u70b9",level:3},{value:"4.2.1 \u5b89\u88c5 k8s \u7ec4\u4ef6",id:"421-\u5b89\u88c5-k8s-\u7ec4\u4ef6",level:4},{value:"4.3 \u4f7f\u7528 kubeadm \u521b\u5efa\u96c6\u7fa4",id:"43-\u4f7f\u7528-kubeadm-\u521b\u5efa\u96c6\u7fa4",level:3},{value:"4.3.1 \u51c6\u5907\u5bb9\u5668\u955c\u50cf (\u6240\u6709\u8282\u70b9)",id:"431-\u51c6\u5907\u5bb9\u5668\u955c\u50cf-\u6240\u6709\u8282\u70b9",level:4},{value:"4.3.2 \u521d\u59cb\u5316\u63a7\u5236\u8282\u70b9 (k8s-master01)",id:"432-\u521d\u59cb\u5316\u63a7\u5236\u8282\u70b9-k8s-master01",level:4},{value:"4.3.3 \u73af\u5883\u53d8\u91cf\u914d\u7f6e (k8s-master01)",id:"433-\u73af\u5883\u53d8\u91cf\u914d\u7f6e-k8s-master01",level:4},{value:"4.3.4 \u5411\u96c6\u7fa4\u4e2d\u52a0\u5165\u5de5\u4f5c\u8282\u70b9(k8s-node01,k8s-node02)",id:"434-\u5411\u96c6\u7fa4\u4e2d\u52a0\u5165\u5de5\u4f5c\u8282\u70b9k8s-node01k8s-node02",level:4},{value:"4.4 \u914d\u7f6e K8s \u7f51\u7edc",id:"44-\u914d\u7f6e-k8s-\u7f51\u7edc",level:3},{value:"4.4.1 \u96c6\u7fa4\u8282\u70b9\u72b6\u6001",id:"441-\u96c6\u7fa4\u8282\u70b9\u72b6\u6001",level:4},{value:"4.4.2 \u5b89\u88c5 calico \u7f51\u7edc\u63d2\u4ef6 (k8s-master01)",id:"442-\u5b89\u88c5-calico-\u7f51\u7edc\u63d2\u4ef6-k8s-master01",level:4}];function o(e){const n={code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",header:"header",img:"img",li:"li",p:"p",pre:"pre",strong:"strong",table:"table",tbody:"tbody",td:"td",th:"th",thead:"thead",tr:"tr",ul:"ul",...(0,i.R)(),...e.components};return(0,c.jsxs)(c.Fragment,{children:[(0,c.jsx)(n.header,{children:(0,c.jsx)(n.h1,{id:"\u5b89\u88c5-k8s",children:"\u5b89\u88c5 K8s"})}),"\n",(0,c.jsx)(n.p,{children:"\u8bb0\u5f55\u4f7f\u7528 CentOS7.9 \u8fdb\u884c k8s-1.28 \u7248\u672c\u90e8\u7f72\uff0c\u8fd0\u884c\u65f6\u73af\u5883\u4f7f\u7528 containerd\uff0c\u7f51\u7edc\u63d2\u4ef6\u4f7f\u7528 calic\uff0c\u96c6\u7fa4\u642d\u5efa\u5b8c\u6210\u540e\u3002\u642d\u5efa NFS \u5171\u4eab\u5b58\u50a8\u73af\u5883\uff0c\u6d4b\u8bd5\u8fd0\u884c pod \u5e76\u6302\u8f7d\u4f7f\u7528\u6301\u4e45\u5377\u3002"}),"\n",(0,c.jsx)(n.h2,{id:"1\u96c6\u7fa4\u89c4\u5212",children:"1.\u96c6\u7fa4\u89c4\u5212"}),"\n",(0,c.jsx)(n.h3,{id:"11-\u673a\u5668\u73af\u5883",children:"1.1 \u673a\u5668\u73af\u5883"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u670d\u52a1\u5668 ip"}),(0,c.jsx)(n.th,{children:"\u4e3b\u673a\u540d"}),(0,c.jsx)(n.th,{children:"\u914d\u7f6e"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"192.168.0.100"}),(0,c.jsx)(n.td,{children:"k8s-master01"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"192.168.0.101"}),(0,c.jsx)(n.td,{children:"k8s-node01"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"192.168.0.102"}),(0,c.jsx)(n.td,{children:"K8s-node02"}),(0,c.jsx)(n.td,{})]})]})]}),"\n",(0,c.jsx)(n.h3,{id:"12-\u8f6f\u4ef6\u73af\u5883",children:"1.2 \u8f6f\u4ef6\u73af\u5883"}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u540d\u79f0"}),(0,c.jsx)(n.th,{children:"\u7248\u672c"}),(0,c.jsx)(n.th,{})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"CentOS"}),(0,c.jsx)(n.td,{children:"7.6"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Kubernetes"}),(0,c.jsx)(n.td,{children:"1.28.2"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"Containerd"}),(0,c.jsx)(n.td,{children:"1.6.28"}),(0,c.jsx)(n.td,{})]})]})]}),"\n",(0,c.jsx)(n.h2,{id:"2-\u524d\u7f6e\u51c6\u5907-\u6240\u6709\u8282\u70b9",children:"2. \u524d\u7f6e\u51c6\u5907 (\u6240\u6709\u8282\u70b9)"}),"\n",(0,c.jsx)(n.h3,{id:"21-\u7981\u7528-selinux",children:"2.1 \u7981\u7528 selinux"}),"\n",(0,c.jsx)(n.p,{children:"\u5728 K8s \u96c6\u7fa4\u7684\u6240\u6709\u8282\u70b9\u90fd\u6267\u884c:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u5c06 SELinux \u8bbe\u7f6e\u4e3a permissive \u6a21\u5f0f\uff08\u76f8\u5f53\u4e8e\u5c06\u5176\u7981\u7528\uff09\n## \u4e34\u65f6\nsetenforce 0\n\n## \u6c38\u4e45\u5173\u95ed\nsed -i 's/^SELINUX=enforcing$/SELINUX=disabled/' /etc/selinux/config\n"})}),"\n",(0,c.jsx)(n.h3,{id:"22-\u7981\u7528-swap",children:"2.2 \u7981\u7528 swap"}),"\n",(0,c.jsx)(n.p,{children:"\u5728 K8s \u96c6\u7fa4\u7684\u6240\u6709\u8282\u70b9\u90fd\u6267\u884c:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u5173\u95edswap\u5206\u533a \n## \u4e34\u65f6\nswapoff -a\n\n## \u6c38\u4e45\nsed -i 's/.*swap.*/#&/' /etc/fstab\n"})}),"\n",(0,c.jsx)(n.h3,{id:"23-\u7981\u7528\u9632\u706b\u5899",children:"2.3 \u7981\u7528\u9632\u706b\u5899"}),"\n",(0,c.jsx)(n.p,{children:"\u5728 K8s \u96c6\u7fa4\u7684\u6240\u6709\u8282\u70b9\u90fd\u6267\u884c:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"systemctl stop firewalld\nsystemctl disable firewalld\n"})}),"\n",(0,c.jsx)(n.h3,{id:"24-\u5347\u7ea7\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838\u975e\u5fc5\u9700",children:"2.4 \u5347\u7ea7\u64cd\u4f5c\u7cfb\u7edf\u5185\u6838(\u975e\u5fc5\u9700)"}),"\n",(0,c.jsx)(n.p,{children:"\u5728 K8s \u96c6\u7fa4\u7684\u6240\u6709\u8282\u70b9\u90fd\u6267\u884c:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"yum -y update kernel*\n"})}),"\n",(0,c.jsx)(n.h3,{id:"25-\u8bbe\u7f6e-nameserver",children:"2.5 \u8bbe\u7f6e nameserver"}),"\n",(0,c.jsx)(n.p,{children:"\u5728 K8s \u96c6\u7fa4\u7684\u6240\u6709\u8282\u70b9\u90fd\u6267\u884c:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"vi /etc/resolv.conf\n\n## \u6dfb\u52a0\u4ee5\u4e0b\u5185\u5bb9\nnameserver 144.144.144.144\nnameserver 8.8.8.8\n"})}),"\n",(0,c.jsx)(n.h3,{id:"26-\u8bbe\u7f6e-hosts",children:"2.6 \u8bbe\u7f6e hosts"}),"\n",(0,c.jsx)(n.p,{children:"\u5728 K8s \u96c6\u7fa4\u7684\u6240\u6709\u8282\u70b9\u90fd\u6267\u884c:"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cat >> /etc/hosts << EOF\n192.168.0.100 k8s-master01\n192.168.0.101 k8s-node01\n192.168.0.102 k8s-node02\nEOF\n"})}),"\n",(0,c.jsx)(n.h3,{id:"27-\u8bbe\u7f6e\u4e3b\u673a\u540d",children:"2.7 \u8bbe\u7f6e\u4e3b\u673a\u540d"}),"\n",(0,c.jsxs)(n.p,{children:["\u767b\u9646\u5230 K8s \u96c6\u7fa4 Master \u8282\u70b9",(0,c.jsx)(n.code,{children:"192.168.0.100"}),"\u4e0a\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"hostnamectl set-hostname k8s-master01\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u767b\u9646\u5230 K8s \u96c6\u7fa4 Node \u8282\u70b9",(0,c.jsx)(n.code,{children:"192.168.0.101"}),"\u4e0a\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"hostnamectl set-hostname k8s-node01\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u767b\u9646\u5230 K8s \u96c6\u7fa4 Master \u8282\u70b9",(0,c.jsx)(n.code,{children:"192.168.0.102"}),"\u4e0a\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"hostnamectl set-hostname k8s-node02\n"})}),"\n",(0,c.jsx)(n.h3,{id:"28-\u8bbe\u7f6e\u65f6\u95f4\u540c\u6b65",children:"2.8 \u8bbe\u7f6e\u65f6\u95f4\u540c\u6b65"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"yum install -y ntpdate\n\nntpdate  time1.aliyun.com\n"})}),"\n",(0,c.jsx)(n.h3,{id:"29-\u5185\u6838\u53c2\u6570\u8c03\u6574",children:"2.9 \u5185\u6838\u53c2\u6570\u8c03\u6574"}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.strong,{children:"\u4ee5\u4e0b\u547d\u4ee4\u5728\u6bcf\u53f0\u670d\u52a1\u5668\u4e0a\u6267\u884c"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | sudo tee /etc/modules-load.d/kubernetes.conf\noverlay\nbr_netfilter\nEOF\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"sudo modprobe overlay\nsudo modprobe br_netfilter\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u8bbe\u7f6e\u6240\u9700\u7684 sysctl \u53c2\u6570\uff0c\u53c2\u6570\u5728\u91cd\u65b0\u542f\u52a8\u540e\u4fdd\u6301\u4e0d\u53d8"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cat <<EOF | sudo tee /etc/sysctl.d/kubernetes.conf\nnet.bridge.bridge-nf-call-iptables  = 1\nnet.bridge.bridge-nf-call-ip6tables = 1\nnet.ipv4.ip_forward                 = 1\nEOF\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u5e94\u7528 sysctl \u53c2\u6570\u800c\u4e0d\u91cd\u65b0\u542f\u52a8"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"sudo sysctl --system\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u6307\u4ee4\u786e\u8ba4 br_netfilter \u548c overlay \u6a21\u5757\u88ab\u52a0\u8f7d"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"lsmod | grep br_netfilter\nlsmod | grep overlay\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u901a\u8fc7\u8fd0\u884c\u4ee5\u4e0b\u6307\u4ee4\u786e\u8ba4 net.bridge.bridge-nf-call-iptables\u3001net.bridge.bridge-nf-call-ip6tables \u548c net.ipv4.ip_forward \u7cfb\u7edf\u53d8\u91cf\u5728\u4f60\u7684 sysctl \u914d\u7f6e\u4e2d\u88ab\u8bbe\u7f6e\u4e3a 1"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"sysctl net.bridge.bridge-nf-call-iptables net.bridge.bridge-nf-call-ip6tables net.ipv4.ip_forward\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"## \u4f7f\u521a\u624d\u4fee\u6539\u7684\u5185\u6838\u53c2\u6570\u751f\u6548\nsysctl -p /etc/sysctl.d/Kubernetes.conf\n"})}),"\n",(0,c.jsx)(n.h3,{id:"210-\u96c6\u7fa4\u514d\u5bc6\u767b\u9646",children:"2.10 \u96c6\u7fa4\u514d\u5bc6\u767b\u9646"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u751f\u6210\u5bc6\u94a5\nssh-keygen -t ecdsa -f /root/.ssh/id_rsa -N ''\n# \u590d\u5236\u5bc6\u94a5\u5230\u6240\u6709\u670d\u52a1\u5668\nssh-copy-id 192.168.0.100\nssh-copy-id 192.168.0.101\nssh-copy-id 192.168.0.102\n"})}),"\n",(0,c.jsx)(n.h3,{id:"211-\u914d\u7f6e-ipvs-\u529f\u80fd",children:"2.11 \u914d\u7f6e ipvs \u529f\u80fd"}),"\n",(0,c.jsx)(n.p,{children:"\u5728 kubernetes \u4e2d Service \u6709\u4e24\u79cd\u4ee3\u7406\u6a21\u578b\uff0c\u4e00\u79cd\u662f\u57fa\u4e8e iptables \u7684\uff0c\u4e00\u79cd\u662f\u57fa\u4e8e ipvs\uff0c\u4e24\u8005\u5bf9\u6bd4 ipvs \u7684\u6027\u80fd\u8981\u9ad8\uff0c\u5982\u679c\u60f3\u8981\u4f7f\u7528 ipvs \u6a21\u578b\uff0c\u9700\u8981\u624b\u52a8\u8f7d\u5165 ipvs \u6a21\u5757"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"yum -y install ipset ipvsadm\ncat > /etc/sysconfig/modules/ipvs.modules << EOF\nmodprobe -- ip_vs\nmodprobe -- ip_vs_rr\nmodprobe -- ip_vs_wrr\nmodprobe -- ip_vs_sh\nmodprobe -- nf_conntrack_ipv4  \nEOF\n\nchmod +x /etc/sysconfig/modules/ipvs.modules # \u6267\u884c\u811a\u672c\n/etc/sysconfig/modules/ipvs.modules\n\n# \u9a8c\u8bc1ipvs\u6a21\u5757\nlsmod | grep -e ip_vs -e nf_conntrack_ipv4\n"})}),"\n",(0,c.jsx)(n.h2,{id:"3-\u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6-\u6240\u6709\u8282\u70b9",children:"3. \u5b89\u88c5\u5bb9\u5668\u8fd0\u884c\u65f6 (\u6240\u6709\u8282\u70b9)"}),"\n",(0,c.jsx)(n.p,{children:"\u4ece k8s 1.24 \u7248\u672c\u5f00\u59cb\uff0c\u8d1f\u8d23 kubelet \u4e0e docker \u76f4\u63a5\u63e1\u624b\u7684 docker-shim \u5df2\u7ecf\u4e0d\u518d\u652f\u6301\uff0c\u8f6c\u800c\u5f3a\u5236\u4f7f\u7528\u5bb9\u5668\u8fd0\u884c\u65f6 Container Runtime \u4f5c\u4e3a kubelet \u548c\u5bb9\u5668\u7684\u6865\u6881\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u76ee\u524d\u5bb9\u5668\u8fd0\u884c\u65f6\u6709\u4e24\u79cd\u9009\u62e9\uff0c\u4e00\u79cd\u662f\u4e0e docker \u6709\u5f3a\u5173\u8054\u7684 cri-dockerd\uff0c\u4e00\u79cd\u662f Containerd\uff0c\u672c\u5b89\u88c5\u624b\u518c\u9009\u7528 Containerd\uff0c\u5728\u524d\u9762\u5b89\u88c5\u4e86\u5bf9\u5e94\u7684 containerd.io \u5305\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u4e3a\u4e86\u8ba9 Containerd \u80fd\u591f\u5728\u540e\u9762\u4e0e kubelet \u6210\u529f\u534f\u540c\uff0c\u8fd9\u91cc\u9700\u8981\u505a\u51e0\u70b9\u4f18\u5316\uff1a"}),"\n",(0,c.jsx)(n.p,{children:"\uff081\uff09Containerd \u5b89\u88c5\u5b8c\u6210\u540e\uff0c\u5176\u81ea\u5e26\u7684\u914d\u7f6e\u6587\u4ef6/etc/containerd/config.toml \u4e2d\u7684\u5185\u5bb9\uff0c\u9700\u8981\u7528\u6253\u5370\u51fa\u7684 containerd \u9ed8\u8ba4\u914d\u7f6e\u66ff\u6362\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\uff082\uff09Containerd \u7684 Cgroup \u8bbe\u4e3a systemd\uff0c\u4ee5\u548c k8s \u9ed8\u8ba4\u7684 Cgroup \u4fdd\u6301\u4e00\u81f4\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\uff083\uff09pause \u955c\u50cf\u8def\u5f84\u6539\u4e3a\u56fd\u5185\u6e90 registry.aliyuncs.com/google_containers/pause:3.9\u3002"}),"\n",(0,c.jsx)(n.h3,{id:"31-containerd",children:"3.1 containerd"}),"\n",(0,c.jsx)(n.h4,{id:"311-\u5b89\u88c5-containerd",children:"3.1.1 \u5b89\u88c5 containerd"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"yum install -y yum-utils\nyum-config-manager --add-repo https://download.docker.com/linux/centos/docker-ce.repo\nyum -y install containerd.io\n"})}),"\n",(0,c.jsx)(n.h4,{id:"312-\u751f\u6210-configtoml-\u914d\u7f6e",children:"3.1.2 \u751f\u6210 config.toml \u914d\u7f6e"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"containerd config default > /etc/containerd/config.toml\n"})}),"\n",(0,c.jsx)(n.h4,{id:"313-\u914d\u7f6e-systemd-cgroup",children:"3.1.3 \u914d\u7f6e systemd cgroup"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'sed -i \'s/SystemdCgroup = false/SystemdCgroup = true/g\' /etc/containerd/config.toml\n\n## \u4fee\u6539\u7ed3\u679c\n[plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc]\n  ...\n  [plugins."io.containerd.grpc.v1.cri".containerd.runtimes.runc.options]\n    SystemdCgroup = true\n\n'})}),"\n",(0,c.jsx)(n.p,{children:"\u5c06 sandbox_image \u4e0b\u8f7d\u5730\u5740\u6539\u4e3a\u963f\u91cc\u4e91\u5730\u5740"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'sed -i \'s|registry.k8s.io|registry.aliyuncs.com/google_containers|g\' /etc/containerd/config.toml\n\n## \u4fee\u6539\u7ed3\u679c\n[plugins."io.containerd.grpc.v1.cri"]\n    ...\n    sandbox_image = "registry.aliyuncs.com/google_containers/pause:3.9"\n'})}),"\n",(0,c.jsx)(n.h4,{id:"314-\u542f\u52a8-containerd-\u5e76\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8",children:"3.1.4 \u542f\u52a8 containerd \u5e76\u8bbe\u7f6e\u5f00\u673a\u81ea\u542f\u52a8"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"systemctl restart containerd && systemctl enable containerd\n"})}),"\n",(0,c.jsx)(n.h4,{id:"315-\u914d\u7f6e\u5ba2\u6237\u7aef\u5de5\u5177",children:"3.1.5 \u914d\u7f6e\u5ba2\u6237\u7aef\u5de5\u5177"}),"\n",(0,c.jsx)(n.p,{children:"crictl \u662f\u9075\u5faa CRI \u63a5\u53e3\u89c4\u8303\u7684\u4e00\u4e2a\u547d\u4ee4\u884c\u5de5\u5177\uff0c\u968f containerd.io \u4e00\u8d77\u5b89\u88c5\uff0c\u5e38\u7528\u5b83\u6765\u68c0\u67e5\u548c\u7ba1\u7406 kubelet \u8282\u70b9\u4e0a\u7684\u5bb9\u5668\u8fd0\u884c\u65f6\u548c\u955c\u50cf\u3002"}),"\n",(0,c.jsx)(n.p,{children:"crictl \u4e0b\u8f7d\u955c\u50cf\u65f6\u4f7f\u7528\u7684\u9ed8\u8ba4\u7aef\u70b9\uff08endpoint\uff09\u662f/var/run/dockershim.sock\uff0c\u8fd9\u4e2a\u5df2\u7ecf\u5728 k8s v1.24 \u8d77\u88ab\u5e9f\u5f03\uff0c\u9700\u8981\u6211\u4eec\u624b\u5de5\u6307\u5b9a\u4e3a\u65b0\u7684\u7aef\u70b9 containerd.sock\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u91cd\u65b0\u6307\u5b9a\u7684\u5de5\u4f5c\u9700\u8981\u901a\u8fc7\u914d\u7f6e/etc/crictl.yaml \u6765\u5b8c\u6210\u3002"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cat > /etc/crictl.yaml <<EOF\nruntime-endpoint: unix:///run/containerd/containerd.sock\nimage-endpoint: unix:///run/containerd/containerd.sock\ntimeout: 10\ndebug: false\nEOF\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u6216\u8005"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u914d\u7f6ecrictl\u5de5\u5177\u8fd0\u884c\u65f6\u63a5\u53e3\u5730\u5740(runtime-endpoint)\ncrictl config --set runtime-endpoint=unix:///run/containerd/containerd.sock\ncrictl config --set image-endpoint=unix:///run/containerd/containerd.sock\ncrictl ps\n"})}),"\n",(0,c.jsx)(n.h2,{id:"4-k8s-\u670d\u52a1\u5b89\u88c5",children:"4. K8s \u670d\u52a1\u5b89\u88c5"}),"\n",(0,c.jsx)(n.h3,{id:"41-k8s-\u914d\u7f6e\u963f\u91cc\u4e91-yum-\u6e90-\u6240\u6709\u8282\u70b9",children:"4.1 k8s \u914d\u7f6e\u963f\u91cc\u4e91 yum \u6e90 (\u6240\u6709\u8282\u70b9)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"cat <<EOF > /etc/yum.repos.d/kubernetes.repo\n[kubernetes]\nname = Kubernetes\nbaseurl = https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64\nenabled = 1\ngpgcheck = 0\nrepo_gpgcheck = 0\ngpgkey = https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg\nEOF\n\n\nyum makecache\n"})}),"\n",(0,c.jsx)(n.h3,{id:"42-kubeadmkubeletkubectl-\u6240\u6709\u8282\u70b9",children:"4.2 kubeadm&kubelet&kubectl (\u6240\u6709\u8282\u70b9)"}),"\n",(0,c.jsxs)(n.ul,{children:["\n",(0,c.jsx)(n.li,{children:"kubeadm\uff1a\u7528\u6765\u521d\u59cb\u5316\u96c6\u7fa4\u7684\u6307\u4ee4\u3002"}),"\n",(0,c.jsx)(n.li,{children:"kubelet\uff1a\u5728\u96c6\u7fa4\u4e2d\u7684\u6bcf\u4e2a\u8282\u70b9\u4e0a\u7528\u6765\u542f\u52a8 Pod \u548c\u5bb9\u5668\u7b49\u3002"}),"\n",(0,c.jsx)(n.li,{children:"kubectl\uff1a\u7528\u6765\u4e0e\u96c6\u7fa4\u901a\u4fe1\u7684\u547d\u4ee4\u884c\u5de5\u5177\u3002"}),"\n"]}),"\n",(0,c.jsx)(n.p,{children:"kubeadm \u4e0d\u80fd\u5e2e\u4f60\u5b89\u88c5\u6216\u8005\u7ba1\u7406 kubelet \u6216 kubectl\uff0c \u6240\u4ee5\u4f60\u9700\u8981\u786e\u4fdd\u5b83\u4eec\u4e0e\u901a\u8fc7 kubeadm \u5b89\u88c5\u7684\u63a7\u5236\u5e73\u9762\u7684\u7248\u672c\u76f8\u5339\u914d\u3002 \u5982\u679c\u4e0d\u8fd9\u6837\u505a\uff0c\u5219\u5b58\u5728\u53d1\u751f\u7248\u672c\u504f\u5dee\u7684\u98ce\u9669\uff0c\u53ef\u80fd\u4f1a\u5bfc\u81f4\u4e00\u4e9b\u9884\u6599\u4e4b\u5916\u7684\u9519\u8bef\u548c\u95ee\u9898\u3002 \u7136\u800c\uff0c\u63a7\u5236\u5e73\u9762\u4e0e kubelet \u4e4b\u95f4\u53ef\u4ee5\u5b58\u5728\u4e00\u4e2a\u6b21\u8981\u7248\u672c\u7684\u504f\u5dee\uff0c\u4f46 kubelet \u7684\u7248\u672c\u4e0d\u53ef\u4ee5\u8d85\u8fc7 API \u670d\u52a1\u5668\u7684\u7248\u672c\u3002 \u4f8b\u5982\uff0c1.7.0 \u7248\u672c\u7684 kubelet \u53ef\u4ee5\u5b8c\u5168\u517c\u5bb9 1.8.0 \u7248\u672c\u7684 API \u670d\u52a1\u5668\uff0c\u53cd\u4e4b\u5219\u4e0d\u53ef\u4ee5\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u8fd9\u4e9b\u8bf4\u660e\u9002\u7528\u4e8e Kubernetes 1.28\uff0c\u963f\u91cc\u7684 yum \u6e90\uff0ckubelet \u7248\u672c\u53ea\u66f4\u65b0\u5230 1.28.0 \u7248\u672c\uff0c\u6240\u4ee5\u4e0b\u9762\u547d\u4ee4\u9700\u8981\u52a0\u4e0a\u7248\u672c\u53f7"}),"\n",(0,c.jsx)(n.h4,{id:"421-\u5b89\u88c5-k8s-\u7ec4\u4ef6",children:"4.2.1 \u5b89\u88c5 k8s \u7ec4\u4ef6"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"yum install -y kubelet-1.28.2 kubeadm-1.28.2 kubectl-1.28.2 --disableexcludes=kubernetes\n"})}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"## \u8bbe\u7f6ekubelet\u5f00\u673a\u542f\u52a8\nsystemctl start kubelet && systemctl enable --now kubelet\n\n## \u6b64\u5904\u8fd8\u65e0\u6cd5\u542f\u52a8kubelet\u670d\u52a1\uff0c\u5728kubeadm init xx \u8fc7\u7a0b\u4e2d\u4f1a\u81ea\u52a8\u542f\u52a8kubelet\nsystemctl status kubelet\n"})}),"\n",(0,c.jsx)(n.h3,{id:"43-\u4f7f\u7528-kubeadm-\u521b\u5efa\u96c6\u7fa4",children:"4.3 \u4f7f\u7528 kubeadm \u521b\u5efa\u96c6\u7fa4"}),"\n",(0,c.jsx)(n.h4,{id:"431-\u51c6\u5907\u5bb9\u5668\u955c\u50cf-\u6240\u6709\u8282\u70b9",children:"4.3.1 \u51c6\u5907\u5bb9\u5668\u955c\u50cf (\u6240\u6709\u8282\u70b9)"}),"\n",(0,c.jsx)(n.p,{children:"\u4ee5\u4e0b\u547d\u4ee4\u5728\u6bcf\u4e2a\u8282\u70b9\u4e0a\u6267\u884c"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubeadm config images list --image-repository registry.aliyuncs.com/google_containers\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{alt:"k8s-docker-images",src:s(72607).A+"",width:"2282",height:"530"})}),"\n",(0,c.jsx)(n.p,{children:"\u4f7f\u7528\u56fd\u5185\u955c\u50cf\u8fdb\u884c\u66ff\u6362\u4e0b\u8f7d\uff0c\u5728\u6b64 pause \u4f7f\u7528 3.9 \u4f1a\u5bfc\u81f4\u96c6\u7fa4\u65e0\u6cd5\u521d\u59cb\u5316\uff0c\u8fd8\u9700\u8981\u4e0b\u8f7d pause:3.6"}),"\n",(0,c.jsx)(n.p,{children:"\u65b9\u6cd5\u4e00"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubeadm config images pull \\\n--image-repository registry.aliyuncs.com/google_containers\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u65b9\u6cd5\u4e8c"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"##\u4e0b\u8f7d\u955c\u50cf\ndocker pull registry.aliyuncs.com/google_containers/kube-apiserver:v1.28.8\ndocker pull registry.aliyuncs.com/google_containers/kube-controller-manager:v1.28.8\ndocker pull registry.aliyuncs.com/google_containers/kube-scheduler:v1.28.8\ndocker pull registry.aliyuncs.com/google_containers/kube-proxy:v1.28.8\ndocker pull registry.aliyuncs.com/google_containers/pause:3.6\ndocker pull registry.aliyuncs.com/google_containers/pause:3.9\ndocker pull registry.aliyuncs.com/google_containers/etcd:3.5.9-0\ndocker pull registry.aliyuncs.com/google_containers/coredns:v1.10.1\n\n\n## \u5c06\u955c\u50cf\u6807\u8bb0\u4e3a\u5b98\u65b9\u955c\u50cf\u7248\u672c\ndocker tag registry.aliyuncs.com/google_containers/kube-apiserver:v1.28.8 registry.k8s.io/kube-apiserver:v1.28.8\ndocker tag registry.aliyuncs.com/google_containers/kube-controller-manager:v1.28.8 registry.k8s.io/kube-controller-manager:v1.28.8\ndocker tag registry.aliyuncs.com/google_containers/kube-scheduler:v1.28.8 registry.k8s.io/kube-scheduler:v1.28.8\ndocker tag registry.aliyuncs.com/google_containers/kube-proxy:v1.28.8 registry.k8s.io/kube-proxy:v1.28.8\ndocker tag registry.aliyuncs.com/google_containers/pause:3.9 registry.k8s.io/pause:3.9\ndocker tag registry.aliyuncs.com/google_containers/pause:3.6 registry.k8s.io/pause:3.6\ndocker tag registry.aliyuncs.com/google_containers/etcd:3.5.9-0 registry.k8s.io/etcd:3.5.9-0\ndocker tag registry.aliyuncs.com/google_containers/coredns:v1.10.1 registry.k8s.io/coredns/coredns:v1.10.1\n\n## \u5220\u9664\u65e7\u7684tag(\u53ef\u6682\u65f6\u4fdd\u7559)\ndocker rmi registry.aliyuncs.com/google_containers/kube-apiserver:v1.28.8\ndocker rmi registry.aliyuncs.com/google_containers/kube-controller-manager:v1.28.8\ndocker rmi registry.aliyuncs.com/google_containers/kube-scheduler:v1.28.8\ndocker rmi registry.aliyuncs.com/google_containers/kube-proxy:v1.28.8\ndocker rmi registry.aliyuncs.com/google_containers/pause:3.6\ndocker rmi registry.aliyuncs.com/google_containers/pause:3.9\ndocker rmi registry.aliyuncs.com/google_containers/etcd:3.5.9-0\ndocker rmi registry.aliyuncs.com/google_containers/coredns:v1.10.1\n"})}),"\n",(0,c.jsx)(n.h4,{id:"432-\u521d\u59cb\u5316\u63a7\u5236\u8282\u70b9-k8s-master01",children:"4.3.2 \u521d\u59cb\u5316\u63a7\u5236\u8282\u70b9 (k8s-master01)"}),"\n",(0,c.jsx)(n.p,{children:"\u81ea\u5b9a\u4e49\u955c\u50cf\u521d\u59cb\u5316 Master \u8282\u70b9"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubeadm init \\\n--kubernetes-version v1.28.2 \\\n--apiserver-advertise-address=0.0.0.0  \\\n--apiserver-bind-port 6443 \\\n--service-cidr=10.96.0.0/16 \\\n--pod-network-cidr=10.120.0.0/16 \\\n--image-repository registry.aliyuncs.com/google_containers \\\n--ignore-preflight-errors=all\n"})}),"\n",(0,c.jsxs)(n.table,{children:[(0,c.jsx)(n.thead,{children:(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.th,{children:"\u53c2\u6570\u540d\u79f0"}),(0,c.jsx)(n.th,{children:"\u53c2\u6570\u542b\u4e49"}),(0,c.jsx)(n.th,{children:"\u9ed8\u8ba4\u503c"})]})}),(0,c.jsxs)(n.tbody,{children:[(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"apiserver-advertise-address"}),(0,c.jsx)(n.td,{children:"API \u670d\u52a1\u5668\u6240\u516c\u5e03\u7684\u5176\u6b63\u5728\u76d1\u542c\u7684 IP \u5730\u5740\u3002\t\u5982\u679c\u672a\u8bbe\u7f6e\uff0c\u5219\u4f7f\u7528\u9ed8\u8ba4\u7f51\u7edc\u63a5\u53e3"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"apiserver-bind-port 6443"}),(0,c.jsx)(n.td,{children:"API \u670d\u52a1\u5668\u7ed1\u5b9a\u7684\u7aef\u53e3\u3002\t6443"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"control-plane-endpoint"}),(0,c.jsx)(n.td,{children:"\u4e3a\u63a7\u5236\u5e73\u9762\u6307\u5b9a\u4e00\u4e2a\u7a33\u5b9a\u7684 IP \u5730\u5740\u6216 DNS \u540d\u79f0\u3002"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"service-cidr"}),(0,c.jsx)(n.td,{children:"\u4e3a\u670d\u52a1\u7684\u865a\u62df IP \u5730\u5740\u53e6\u5916\u6307\u5b9a IP \u5730\u5740\u6bb5\u3002\t\u201c10.96.0.0/12\u201d"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"service-dns-domain"}),(0,c.jsx)(n.td,{children:"\u4e3a\u670d\u52a1\u53e6\u5916\u6307\u5b9a\u57df\u540d\t\u201ccluster.local\u201d"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"pod-network-cidr"}),(0,c.jsx)(n.td,{children:"\u6307\u660e Pod \u7f51\u7edc\u53ef\u4ee5\u4f7f\u7528\u7684 IP \u5730\u5740\u6bb5\u3002\u5982\u679c\u8bbe\u7f6e\u4e86\u8fd9\u4e2a\u53c2\u6570\uff0c\u63a7\u5236\u5e73\u9762\u5c06\u4f1a\u4e3a\u6bcf\u4e00\u4e2a\u8282\u70b9\u81ea\u52a8\u5206\u914d CIDR\u3002"}),(0,c.jsx)(n.td,{})]}),(0,c.jsxs)(n.tr,{children:[(0,c.jsx)(n.td,{children:"image-repository"}),(0,c.jsx)(n.td,{children:"\u9009\u62e9\u7528\u4e8e\u62c9\u53d6\u63a7\u5236\u5e73\u9762\u955c\u50cf\u7684\u5bb9\u5668\u4ed3\u5e93\u3002\t\u201cregistry.k8s.io\u201d"}),(0,c.jsx)(n.td,{})]})]})]}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{alt:"k8s-master-init",src:s(12329).A+"",width:"1972",height:"3478"})}),"\n",(0,c.jsx)(n.p,{children:"\u5f97\u5230\u4ee5\u4e0b\u5185\u5bb9,\u8868\u793a\u5b89\u88c5\u6210\u529f"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'Your Kubernetes control-plane has initialized successfully!\n\nTo start using your cluster, you need to run the following as a regular user:\n\n  mkdir -p $HOME/.kube\n  sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\n  sudo chown $(id -u):$(id -g) $HOME/.kube/config\n\nAlternatively, if you are the root user, you can run:\n\n  export KUBECONFIG=/etc/kubernetes/admin.conf\n\nYou should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 10.172.29.181:6443 --token 8lcscl.knznlq03nvckm78i \\\n        --discovery-token-ca-cert-hash sha256:09b88897ffcecb2896bb80de49cd4ca986cdc513fd9bf9af30b8087395b08b38  \n'})}),"\n",(0,c.jsx)(n.h4,{id:"433-\u73af\u5883\u53d8\u91cf\u914d\u7f6e-k8s-master01",children:"4.3.3 \u73af\u5883\u53d8\u91cf\u914d\u7f6e (k8s-master01)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u8bbe\u7f6e\u73af\u5883\u53d8\u91cf\uff0c\u5b98\u7f51\u5efa\u8baeroot\u7528\u6237\u4f7f\u7528\nexport KUBECONFIG=/etc/kubernetes/admin.conf\ncat <<EOF | tee -a ~/.bash_profile\nexport KUBECONFIG=/etc/kubernetes/admin.conf\nEOF\nsource  ~/.bash_profile\n\n# \u590d\u5236\u63a7\u5236\u914d\u7f6e\uff0c\u4fbf\u4e8e\u540e\u7ee7\u4f7f\u7528kubectl\nmkdir -p $HOME/.kube\nsudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config\nsudo chown $(id -u):$(id -g) $HOME/.kube/config\n\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u73b0\u5728\u53ef\u4ee5\u770b\u5230 master \u8282\u70b9\u4e86"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubectl get node\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{alt:"master-init-succ",src:s(31619).A+"",width:"2264",height:"180"})}),"\n",(0,c.jsx)(n.h4,{id:"434-\u5411\u96c6\u7fa4\u4e2d\u52a0\u5165\u5de5\u4f5c\u8282\u70b9k8s-node01k8s-node02",children:"4.3.4 \u5411\u96c6\u7fa4\u4e2d\u52a0\u5165\u5de5\u4f5c\u8282\u70b9(k8s-node01,k8s-node02)"}),"\n",(0,c.jsx)(n.p,{children:"\u63a7\u5236\u8282\u70b9\u521d\u59cb\u5316\u65f6\u8f93\u51fa\u4ee5\u4e0b\u547d\u4ee4\uff0c\u7528\u4e8e\u6dfb\u52a0\u7ba1\u7406\u8282\u70b9\u4e0e\u5de5\u4f5c\u8282\u70b9"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:'You should now deploy a pod network to the cluster.\nRun "kubectl apply -f [podnetwork].yaml" with one of the options listed at:\n  https://kubernetes.io/docs/concepts/cluster-administration/addons/\n\nThen you can join any number of worker nodes by running the following on each as root:\n\nkubeadm join 10.172.29.181:6443 --token 8lcscl.knznlq03nvckm78i \\\n        --discovery-token-ca-cert-hash sha256:09b88897ffcecb2896bb80de49cd4ca986cdc513fd9bf9af30b8087395b08b38  \n'})}),"\n",(0,c.jsxs)(n.p,{children:["\u767b\u9646\u5b50\u8282\u70b9 ",(0,c.jsx)(n.code,{children:"192.168.0.101"}),"\u548c",(0,c.jsx)(n.code,{children:"192.168.0.102"}),",\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4:"]}),"\n",(0,c.jsx)(n.p,{children:"\u7531\u4e8e\u4f7f\u7528\u4e86 cri-dockerd\uff0c\u9700\u8981\u6307\u5b9a cri-socket \u53c2\u6570\u7528\u4e8e\u52a0\u5165\u96c6\u7fa4\u5de5\u4f5c\u8282\u70b9"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubeadm join 10.172.29.181:6443 --token 8lcscl.knznlq03nvckm78i \\\n        --discovery-token-ca-cert-hash sha256:09b88897ffcecb2896bb80de49cd4ca986cdc513fd9bf9af30b8087395b08b38 \n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{alt:"node-join",src:s(33618).A+"",width:"1902",height:"594"})}),"\n",(0,c.jsxs)(n.p,{children:["\u5b50\u8282\u70b9\u52a0\u5165\u96c6\u7fa4\u6210\u529f\uff0c\u767b\u9646\u5230 Master \u8282\u70b9\u673a\u5668 ",(0,c.jsx)(n.code,{children:"192.168.0.100"}),"\uff0c\u6267\u884c\u4ee5\u4e0b\u547d\u4ee4:"]}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"kubectl get node\n"})}),"\n",(0,c.jsx)(n.p,{children:(0,c.jsx)(n.img,{alt:"node-join-success",src:s(37180).A+"",width:"2272",height:"344"})}),"\n",(0,c.jsx)(n.h3,{id:"44-\u914d\u7f6e-k8s-\u7f51\u7edc",children:"4.4 \u914d\u7f6e K8s \u7f51\u7edc"}),"\n",(0,c.jsx)(n.p,{children:"K8s \u96c6\u7fa4\u5fc5\u987b\u90e8\u7f72\u4e00\u4e2a\u57fa\u4e8e Pod \u7f51\u7edc\u63d2\u4ef6\u7684 \u5bb9\u5668\u7f51\u7edc\u63a5\u53e3 (CNI)\uff0c\u4ee5\u4fbf Pod \u53ef\u4ee5\u76f8\u4e92\u901a\u4fe1\u3002 \u5728\u5b89\u88c5\u7f51\u7edc\u4e4b\u524d\uff0c\u96c6\u7fa4 DNS (CoreDNS) \u5c06\u4e0d\u4f1a\u542f\u52a8\u3002"}),"\n",(0,c.jsx)(n.p,{children:"\u6ce8\u610f Pod \u7f51\u7edc\u4e0d\u5f97\u4e0e\u4efb\u4f55\u4e3b\u673a\u7f51\u7edc\u91cd\u53e0\uff1a \u5982\u679c\u6709\u91cd\u53e0\uff0c\u4f60\u5f88\u53ef\u80fd\u4f1a\u9047\u5230\u95ee\u9898\u3002 \uff08\u5982\u679c\u4f60\u53d1\u73b0\u7f51\u7edc\u63d2\u4ef6\u7684\u9996\u9009 Pod \u7f51\u7edc\u4e0e\u67d0\u4e9b\u4e3b\u673a\u7f51\u7edc\u4e4b\u95f4\u5b58\u5728\u51b2\u7a81\uff0c \u5219\u5e94\u8003\u8651\u4f7f\u7528\u4e00\u4e2a\u5408\u9002\u7684 CIDR \u5757\u6765\u4ee3\u66ff\uff0c \u7136\u540e\u5728\u6267\u884c kubeadm init \u65f6\u4f7f\u7528 --pod-network-cidr \u53c2\u6570\u5e76\u5728\u4f60\u7684\u7f51\u7edc\u63d2\u4ef6\u7684 YAML \u4e2d\u66ff\u6362\u5b83\uff09\u3002\n\u5e38\u89c1\u7684\u7f51\u7edc\u63d2\u4ef6\u6709 flannel\uff0cCalico\uff0cCanal\uff0cWeave\uff0c\u672c\u6b21\u4f7f\u7528 Calico \u7ec4\u4ef6\u8fdb\u884c\u7f51\u7edc\u914d\u7f6e"}),"\n",(0,c.jsx)(n.h4,{id:"441-\u96c6\u7fa4\u8282\u70b9\u72b6\u6001",children:"4.4.1 \u96c6\u7fa4\u8282\u70b9\u72b6\u6001"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"[root@Kubernetes-master01 ~]# kubectl get pods -n kube-system\nNAME                                   READY   STATUS              RESTARTS   AGE\ncoredns-66f779496c-46r4p               0/1     Pending             0          11m\ncoredns-66f779496c-kjz67               0/1     Pending             0          11m\netcd-Kubernetes-master01                      1/1     Running             1          11m\nkube-apiserver-Kubernetes-master01            1/1     Running             1          11m\nkube-controller-manager-Kubernetes-master01   1/1     Running             13         11m\nkube-proxy-87g75                       0/1     ContainerCreating   0          4m10s\nkube-proxy-flpz9                       1/1     Running             0          11m\nkube-scheduler-Kubernetes-master01            1/1     Running             13         11m\n\n[root@Kubernetes-master01 ~]# kubectl get nodes\nNAME           STATUS     ROLES           AGE     VERSION\nKubernetes-master01   NotReady   control-plane   11m     v1.28.2\nKubernetes-node01     NotReady   <none>          4m19s   v1.28.2\n"})}),"\n",(0,c.jsxs)(n.p,{children:["\u53ef\u4ee5\u770b\u5230",(0,c.jsx)(n.strong,{children:"master \u548c node \u90fd\u663e\u793a NotReady"}),"\u3002\u8fd9\u662f\u56e0\u4e3a k8s \u6ca1\u6709\u914d\u7f6e\u7f51\u7edc\u7684\u539f\u56e0\u3002\u4e0b\u9762\u5f00\u59cb\u914d\u7f6e calico \u7f51\u7edc"]}),"\n",(0,c.jsx)(n.h4,{id:"442-\u5b89\u88c5-calico-\u7f51\u7edc\u63d2\u4ef6-k8s-master01",children:"4.4.2 \u5b89\u88c5 calico \u7f51\u7edc\u63d2\u4ef6 (k8s-master01)"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"# \u4e0b\u8f7d\u914d\u7f6e\u6587\u4ef6\nwget https://github.com/projectcalico/calico/blob/master/manifests/calico.yaml\n\n## \u5b89\u88c5calico\nkubectl apply -f  calico.yaml\n"})}),"\n",(0,c.jsx)(n.p,{children:"\u7b49\u5f85\u4e00\u4f1a\uff0c\u518d\u6b21\u67e5\u770b node\uff0c\u53d1\u73b0\u73b0\u5728 node \u72b6\u6001\u5df2\u7ecf\u53d8\u4e3a\u4e86 Ready"}),"\n",(0,c.jsx)(n.pre,{children:(0,c.jsx)(n.code,{className:"language-bash",children:"[root@k8s-master01]# kubectl get pod -n kube-system\nNAME                                       READY   STATUS              RESTARTS   AGE\ncalico-kube-controllers-57758d645c-kjl5x   0/1     ContainerCreating   0          86s\ncalico-node-8t2x2                          1/1     Running             0          86s\ncalico-node-dst6w                          1/1     Running             0          86s\ncalico-node-dzppx                          1/1     Running             0          86s\ncoredns-66f779496c-658b8                   1/1     Running             0          6m14s\ncoredns-66f779496c-k59qm                   1/1     Running             0          6m14s\netcd-k8s-master01                          1/1     Running             12         6m27s\nkube-apiserver-k8s-master01                1/1     Running             12         6m27s\nkube-controller-manager-k8s-master01       1/1     Running             24         6m28s\nkube-proxy-4p8ss                           1/1     Running             0          6m14s\nkube-proxy-k77hf                           1/1     Running             0          3m22s\nkube-proxy-xh5vk                           1/1     Running             0          116s\nkube-scheduler-k8s-master01                1/1     Running             24         6m29s\n\n[root@k8s-master01]# kubectl get nodes\nNAME           STATUS   ROLES           AGE     VERSION\nk8s-master01   Ready    control-plane   6m35s   v1.28.2\nk8s-node01     Ready    <none>          3m27s   v1.28.2\nk8s-node02     Ready    <none>          2m1s    v1.28.2\n"})})]})}function h(e={}){const{wrapper:n}={...(0,i.R)(),...e.components};return n?(0,c.jsx)(n,{...e,children:(0,c.jsx)(o,{...e})}):o(e)}},12329:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s-master-init-ca6426e95780863b5d47760ac76db4f1.jpg"},28453:(e,n,s)=>{s.d(n,{R:()=>l,x:()=>d});var r=s(96540);const c={},i=r.createContext(c);function l(e){const n=r.useContext(i);return r.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function d(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(c):e.components||c:l(e.components),r.createElement(i.Provider,{value:n},e.children)}},31619:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/master-init-succ-c1f47d5041bcf1b1755f17ea9f8a1712.jpg"},33618:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/node-join-92eb94e37664b795d30a41c5d809649e.jpg"},37180:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/node-join-success-b055afcf8844bd3b9975f3ea409b8494.jpg"},72607:(e,n,s)=>{s.d(n,{A:()=>r});const r=s.p+"assets/images/k8s-docker-images-3c76c67c0adc6d7e7aab0133a225127c.jpg"}}]);