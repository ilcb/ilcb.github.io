"use strict";(self.webpackChunkdoc_hub=self.webpackChunkdoc_hub||[]).push([[9452],{3451:(n,e,t)=>{t.r(e),t.d(e,{assets:()=>l,contentTitle:()=>o,default:()=>u,frontMatter:()=>c,metadata:()=>i,toc:()=>d});const i=JSON.parse('{"id":"Backend/Java/Java\u5e76\u53d1\u4e4b\u9501/Java\u5e76\u53d1\u4e4b\u9501","title":"Java \u5e76\u53d1\u4e4b\u9501","description":"Java \u5e76\u53d1\u4e4b\u9501","source":"@site/docs/Backend/Java/Java\u5e76\u53d1\u4e4b\u9501/Java\u5e76\u53d1\u4e4b\u9501.md","sourceDirName":"Backend/Java/Java\u5e76\u53d1\u4e4b\u9501","slug":"/backend/java/concurrent","permalink":"/docs/backend/java/concurrent","draft":false,"unlisted":false,"editUrl":"https://github.com/facebook/docusaurus/tree/main/packages/create-docusaurus/templates/shared/docs/Backend/Java/Java\u5e76\u53d1\u4e4b\u9501/Java\u5e76\u53d1\u4e4b\u9501.md","tags":[{"inline":true,"label":"Java","permalink":"/docs/tags/java"},{"inline":true,"label":"\u5e76\u53d1","permalink":"/docs/tags/\u5e76\u53d1"}],"version":"current","frontMatter":{"title":"Java \u5e76\u53d1\u4e4b\u9501","description":"Java \u5e76\u53d1\u4e4b\u9501","slug":"/backend/java/concurrent","hide_table_of_contents":false,"keywords":["Java","\u5e76\u53d1"],"tags":["Java","\u5e76\u53d1"],"date":"2017-08-01T00:00:00.000Z","categories":["Java"]},"sidebar":"backendSideBar","previous":{"title":"Java IO","permalink":"/docs/backend/java/io"},"next":{"title":"Java \u5f02\u5e38","permalink":"/docs/backend/java/exception"}}');var r=t(74848),a=t(28453);const c={title:"Java \u5e76\u53d1\u4e4b\u9501",description:"Java \u5e76\u53d1\u4e4b\u9501",slug:"/backend/java/concurrent",hide_table_of_contents:!1,keywords:["Java","\u5e76\u53d1"],tags:["Java","\u5e76\u53d1"],date:new Date("2017-08-01T00:00:00.000Z"),categories:["Java"]},o=void 0,l={},d=[{value:"synchronized VS Lock",id:"synchronized-vs-lock",level:2},{value:"synchronized \u7684\u7f3a\u9677",id:"synchronized-\u7684\u7f3a\u9677",level:3},{value:"java.util.concurrent.locks \u4e0b\u5e76\u53d1\u76f8\u5173\u7c7b",id:"javautilconcurrentlocks-\u4e0b\u5e76\u53d1\u76f8\u5173\u7c7b",level:2},{value:"Lock \u63a5\u53e3",id:"lock-\u63a5\u53e3",level:3},{value:"ReentrantLock",id:"reentrantlock",level:3},{value:"\u793a\u4f8b",id:"\u793a\u4f8b",level:4},{value:"ReadWriteLock \u63a5\u53e3",id:"readwritelock-\u63a5\u53e3",level:3},{value:"\u793a\u4f8b",id:"\u793a\u4f8b-1",level:4},{value:"ReentrantReadWriteLock",id:"reentrantreadwritelock",level:3},{value:"Lock \u548c synchronized \u7684\u9009\u62e9",id:"lock-\u548c-synchronized-\u7684\u9009\u62e9",level:3},{value:"Condition",id:"condition",level:2},{value:"\u6761\u4ef6\u53d8\u91cf Condition",id:"\u6761\u4ef6\u53d8\u91cf-condition",level:3},{value:"Condition \u65b9\u6cd5",id:"condition-\u65b9\u6cd5",level:3},{value:"Condition \u5b9e\u73b0\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u793a\u4f8b",id:"condition-\u5b9e\u73b0\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u793a\u4f8b",level:3},{value:"\u9501\u7684\u6982\u5ff5",id:"\u9501\u7684\u6982\u5ff5",level:2},{value:"\u53ef\u91cd\u5165\u9501",id:"\u53ef\u91cd\u5165\u9501",level:3},{value:"\u53ef\u4e2d\u65ad\u9501",id:"\u53ef\u4e2d\u65ad\u9501",level:3},{value:"\u516c\u5e73\u9501",id:"\u516c\u5e73\u9501",level:3},{value:"\u8bfb\u5199\u9501",id:"\u8bfb\u5199\u9501",level:3},{value:"\u6b7b\u9501",id:"\u6b7b\u9501",level:2},{value:"\u4e92\u65a5\u6761\u4ef6",id:"\u4e92\u65a5\u6761\u4ef6",level:3},{value:"\u8bf7\u6c42\u548c\u4fdd\u6301\u6761\u4ef6",id:"\u8bf7\u6c42\u548c\u4fdd\u6301\u6761\u4ef6",level:3},{value:"\u4e0d\u5265\u593a\u6761\u4ef6",id:"\u4e0d\u5265\u593a\u6761\u4ef6",level:3},{value:"\u73af\u8def\u7b49\u5f85\u6761\u4ef6",id:"\u73af\u8def\u7b49\u5f85\u6761\u4ef6",level:3}];function s(n){const e={code:"code",h2:"h2",h3:"h3",h4:"h4",img:"img",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,a.R)(),...n.components};return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(e.h2,{id:"synchronized-vs-lock",children:"synchronized VS Lock"}),"\n",(0,r.jsx)(e.h3,{id:"synchronized-\u7684\u7f3a\u9677",children:"synchronized \u7684\u7f3a\u9677"}),"\n",(0,r.jsx)(e.p,{children:"synchronized \u662f java \u4e2d\u7684\u4e00\u4e2a\u5173\u952e\u5b57\uff0c\u4e5f\u5c31\u662f\u8bf4\u662f Java \u8bed\u8a00\u5185\u7f6e\u7684\u7279\u6027\u3002\u90a3\u4e48\u4e3a\u4ec0\u4e48\u4f1a\u51fa\u73b0 Lock \u5462\uff1f"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u4e00\u4e2a\u4ee3\u7801\u5757\u88ab synchronized \u4fee\u9970\u4e86\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u4e86\u5bf9\u5e94\u7684\u9501\uff0c\u5e76\u6267\u884c\u8be5\u4ee3\u7801\u5757\u65f6\uff0c\u5176\u4ed6\u7ebf\u7a0b\u4fbf\u53ea\u80fd\u4e00\u76f4\u7b49\u5f85\uff0c\u7b49\u5f85\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u91ca\u653e\u9501\uff0c\u800c\u8fd9\u91cc\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u91ca\u653e\u9501\u4f1a\u6709\u4e09\u79cd\u60c5\u51b5:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u6267\u884c\u5b8c\u4e86\u8be5\u4ee3\u7801\u5757\uff0c\u7136\u540e\u7ebf\u7a0b\u91ca\u653e\u5bf9\u9501\u7684\u5360\u6709\uff1b"}),"\n",(0,r.jsx)(e.li,{children:"\u7ebf\u7a0b\u6267\u884c\u53d1\u751f\u5f02\u5e38\uff0c\u6b64\u65f6 JVM \u4f1a\u8ba9\u7ebf\u7a0b\u81ea\u52a8\u91ca\u653e\u9501\u3002"}),"\n",(0,r.jsx)(e.li,{children:"\u8fd9\u4e2a\u4e3b\u8981\u662f\u5728\u7b49\u5f85\u5524\u9192\u673a\u5236\u91cc\u9762\u7684 wait()\u65b9\u6cd5\uff0c//\u5728\u7b49\u5f85\u7684\u65f6\u5019\u7acb\u5373\u91ca\u653e\u9501\uff0c\u65b9\u4fbf\u5176\u4ed6\u7684\u7ebf\u7a0b\u4f7f\u7528\u9501\u800c\u4e14\u88ab\u5524\u9192\u65f6\uff0c\u5c31\u5728\u6b64\u5904\u5524\u9192\uff0c"}),"\n"]}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u8fd9\u4e2a\u83b7\u53d6\u9501\u7684\u7ebf\u7a0b\u7531\u4e8e\u8981\u7b49\u5f85 IO \u6216\u8005\u5176\u4ed6\u539f\u56e0\uff08\u6bd4\u5982\u8c03\u7528 sleep \u65b9\u6cd5\uff09\u88ab\u963b\u585e\u4e86\uff0c\u4f46\u662f\u53c8\u6ca1\u6709\u91ca\u653e\u9501\uff0c\u5176\u4ed6\u7ebf\u7a0b\u4fbf\u53ea\u80fd\u4e00\u76f4\u7b49\u5f85\uff0c\u975e\u5e38\u5f71\u54cd\u7a0b\u5e8f\u6267\u884c\u6548\u7387\u3002\u56e0\u56e0\u6b64\u5c31\u9700\u8981\u6709\u4e00\u79cd\u673a\u5236\u53ef\u4ee5\u4e0d\u8ba9\u7b49\u5f85\u7684\u7ebf\u7a0b\u4e00\u76f4\u65e0\u671f\u9650\u5730\u7b49\u5f85\u4e0b\u53bb\uff08\u6bd4\u5982\u53ea\u7b49\u5f85\u4e00\u5b9a\u7684\u65f6\u95f4\u6216\u8005\u80fd\u591f\u54cd\u5e94\u4e2d\u65ad\uff09\uff0c\u901a\u8fc7 Lock \u5c31\u53ef\u4ee5\u529e\u5230\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u6211\u4eec\u53ef\u4ee5\u7406\u89e3\u540c\u6b65\u4ee3\u7801\u5757\u548c\u540c\u6b65\u65b9\u6cd5\u7684\u9501\u5bf9\u8c61\u95ee\u9898\uff0c\u4f46\u662f\u6211\u4eec\u5e76\u6ca1\u6709\u76f4\u63a5\u770b\u5230\u5728\u54ea\u91cc\u52a0\u4e0a\u4e86\u9501\uff0c\u5728\u54ea\u91cc\u91ca\u653e\u4e86\u9501\uff0c\u540c\u65f6\u4e3a\u4e86\u66f4\u597d\u5730\u91ca\u653e\u9501\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u4e3a\u4e86\u66f4\u6e05\u6670\u7684\u8868\u8fbe\u5982\u4f55\u52a0\u9501\u548c\u91ca\u653e\u9501\uff0cJDK5 \u4ee5\u540e\u63d0\u4f9b\u4e86\u4e00\u4e2a\u65b0\u7684\u9501\u5bf9\u8c61 Lock\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u53e6\u5916\uff0c\u901a\u8fc7 Lock \u53ef\u4ee5\u77e5\u9053\u7ebf\u7a0b\u6709\u6ca1\u6709\u6210\u529f\u83b7\u53d6\u5230\u9501\uff0c\u8fd9\u4e2a\u662f synchronized \u65e0\u6cd5\u529e\u5230\u7684\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u603b\u7ed3\u4e00\u4e0b\uff0cLock \u63d0\u4f9b\u4e86\u6bd4 synchronized \u66f4\u591a\u7684\u529f\u80fd:"}),"\n",(0,r.jsxs)(e.ul,{children:["\n",(0,r.jsx)(e.li,{children:"Lock \u4e0d\u662f Java \u8bed\u8a00\u5185\u7f6e\u7684\uff0csynchronized \u662f Java \u8bed\u8a00\u7684\u5173\u952e\u5b57\uff0c\u56e0\u6b64\u662f\u5185\u7f6e\u7279\u6027\u3002Lock \u662f\u4e00\u4e2a\u7c7b\uff0c\u901a\u8fc7\u8fd9\u4e2a\u7c7b\u53ef\u4ee5\u5b9e\u73b0\u540c\u6b65\u8bbf\u95ee\uff1b"}),"\n",(0,r.jsxs)(e.li,{children:["synchronized \u662f\u5728 JVM \u5c42\u9762\u4e0a\u5b9e\u73b0\u7684\uff0c\u4e0d\u4f46\u53ef\u4ee5\u901a\u8fc7\u4e00\u4e9b\u76d1\u63a7\u5de5\u5177\u76d1\u63a7 synchronized \u7684\u9501\u5b9a\uff0c\u800c\u4e14\u5728\u4ee3\u7801\u6267\u884c\u65f6\u51fa\u73b0\u5f02\u5e38\uff0cJVM \u4f1a\u81ea\u52a8\u91ca\u653e\u9501\u5b9a\uff0c\u4f46\u662f\u4f7f\u7528 Lock \u5219\u4e0d\u884c\uff0cLock \u662f\u901a\u8fc7\u4ee3\u7801\u5b9e\u73b0\u7684\uff0c\u8981\u4fdd\u8bc1\u9501\u5b9a\u4e00\u5b9a\u4f1a\u88ab\u91ca\u653e\uff0c\u5c31\u5fc5\u987b\u5c06 unLock()\u653e\u5230 finally","\u4e2d\uff1b"]}),"\n",(0,r.jsx)(e.li,{children:"\u5728\u8d44\u6e90\u7ade\u4e89\u4e0d\u662f\u5f88\u6fc0\u70c8\u7684\u60c5\u51b5\u4e0b\uff0cSynchronized \u7684\u6027\u80fd\u8981\u4f18\u4e8e ReetrantLock\uff0c\u4f46\u662f\u5728\u8d44\u6e90\u7ade\u4e89\u5f88\u6fc0\u70c8\u7684\u60c5\u51b5\u4e0b\uff0cSynchronized \u7684\u6027\u80fd\u4f1a\u4e0b\u964d\u51e0\u5341\u500d\uff0c\u4f46\u662f ReetrantLock \u7684\u6027\u80fd\u80fd\u7ef4\u6301\u5e38\u6001\uff1b"}),"\n",(0,r.jsx)(e.li,{children:"Lock \u548c synchronized \u6709\u4e00\u70b9\u5f88\u5927\u7684\u4e0d\u540c\uff0c\u91c7\u7528 synchronized \u4e0d\u9700\u8981\u7528\u6237\u53bb\u624b\u52a8\u91ca\u653e\u9501\uff0c\u5f53 synchronized \u65b9\u6cd5\u6216\u8005 synchronized \u4ee3\u7801\u5757\u6267\u884c\u5b8c\u4e4b\u540e\uff0c\u7cfb\u7edf\u4f1a\u81ea\u52a8\u8ba9\u7ebf\u7a0b\u91ca\u653e\u5bf9\u9501\u7684\u5360\u7528\uff1b\u800c Lock \u5219\u5fc5\u987b\u8981\u7528\u6237\u53bb\u624b\u52a8\u91ca\u653e\u9501\uff0c\u5982\u679c\u6ca1\u6709\u4e3b\u52a8\u91ca\u653e\u9501\uff0c\u5c31\u6709\u53ef\u80fd\u5bfc\u81f4\u51fa\u73b0\u6b7b\u9501\u73b0\u8c61\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"javautilconcurrentlocks-\u4e0b\u5e76\u53d1\u76f8\u5173\u7c7b",children:"java.util.concurrent.locks \u4e0b\u5e76\u53d1\u76f8\u5173\u7c7b"}),"\n",(0,r.jsx)(e.h3,{id:"lock-\u63a5\u53e3",children:"Lock \u63a5\u53e3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"public interface Lock {\n    void lock();\n    void lockInterruptibly() throws InterruptedException;\n    boolean tryLock();\n    boolean tryLock(long time, TimeUnit unit) throws InterruptedException;\n    void unlock();\n    Condition newCondition();\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"lock(): \u83b7\u53d6\u9501\uff0c\u5982\u679c\u9501\u5df2\u88ab\u5176\u4ed6\u7ebf\u7a0b\u83b7\u53d6\uff0c\u5219\u8fdb\u884c\u7b49\u5f85\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u91c7\u7528 Lock\uff0c\u5fc5\u987b\u4e3b\u52a8\u53bb\u91ca\u653e\u9501\uff0c\u5e76\u4e14\u5728\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u4e0d\u4f1a\u81ea\u52a8\u91ca\u653e\u9501\u3002"}),"\n",(0,r.jsxs)(e.p,{children:["\u4e00\u822c\u6765\u8bf4\uff0c\u4f7f\u7528 Lock \u5fc5\u987b\u5728 try"," catch","\u5757\u4e2d\u8fdb\u884c\uff0c\u5e76\u4e14\u5c06\u91ca\u653e\u9501\u7684\u64cd\u4f5c\u653e\u5728 finally \u5757\u4e2d\u8fdb\u884c\uff0c\u4ee5\u4fdd\u8bc1\u9501\u4e00\u5b9a\u88ab\u88ab\u91ca\u653e\uff0c\u9632\u6b62\u6b7b\u9501\u7684\u53d1\u751f\u3002"]}),"\n",(0,r.jsx)(e.p,{children:"lock()\u4f7f\u7528\u793a\u4f8b:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"Lock lock = new ReentrantLock();\nlock.lock();\ntry {\n    \n} catch (Exception e) {\n    e.printStackTrace();\n} finally {\n    lock.unlock();\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"tryLock():\u7528\u6765\u5c1d\u8bd5\u83b7\u53d6\u9501\uff0c\u5982\u679c\u83b7\u53d6\u6210\u529f\uff0c\u5219\u8fd4\u56de true\uff0c\u5982\u679c\u83b7\u53d6\u5931\u8d25\uff08\u5373\u9501\u5df2\u88ab\u5176\u4ed6\u7ebf\u7a0b\u83b7\u53d6\uff09\uff0c\u5219\u8fd4\u56de false\uff0c\u8fd9\u4e2a\u65b9\u6cd5\u65e0\u8bba\u5982\u4f55\u90fd\u4f1a\u7acb\u5373\u8fd4\u56de\uff0c\u62ff\u4e0d\u5230\u9501\u65f6\u4e0d\u4f1a\u4e00\u76f4\u7b49\u5f85\u3002"}),"\n",(0,r.jsx)(e.p,{children:"tryLock(long time, TimeUnit unit):\u548c tryLock()\u65b9\u6cd5\u662f\u7c7b\u4f3c\u7684\uff0c\u533a\u522b\u5728\u4e8e\u8fd9\u4e2a\u65b9\u6cd5\u5728\u62ff\u4e0d\u5230\u9501\u65f6\u4f1a\u7b49\u5f85\u4e00\u5b9a\u7684\u65f6\u95f4\uff0c\u5728\u65f6\u95f4\u671f\u9650\u4e4b\u5185\u5982\u679c\u8fd8\u62ff\u4e0d\u5230\u9501\uff0c\u5c31\u8fd4\u56de false\u3002\u5982\u679c\u5982\u679c\u4e00\u5f00\u59cb\u62ff\u5230\u9501\u6216\u8005\u5728\u7b49\u5f85\u671f\u95f4\u5185\u62ff\u5230\u4e86\u9501\uff0c\u5219\u8fd4\u56de true\u3002"}),"\n",(0,r.jsx)(e.p,{children:"tryLock()\u4f7f\u7528\u793a\u4f8b:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"Lock lock = new ReentrantLock();\nif (lock.tryLock()) {\n    try {\n\n    } catch (Exception e) {\n        e.printStackTrace();\n    } finally {\n        lock.unlock();\n    }\n} else {\n    \n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"lockInterruptibly():\u901a\u8fc7\u8fd9\u4e2a\u65b9\u6cd5\u53bb\u83b7\u53d6\u9501\u65f6\uff0c\u5982\u679c\u7ebf\u7a0b\u6b63\u5728\u7b49\u5f85\u83b7\u53d6\u9501\uff0c\u5219\u8fd9\u4e2a\u7ebf\u7a0b\u80fd\u591f\u54cd\u5e94\u4e2d\u65ad\uff0c\u5373\u4e2d\u65ad\u7ebf\u7a0b\u7684\u7b49\u5f85\u72b6\u6001\u3002\u4e5f\u5c31\u4f7f\u8bf4\uff0c\u5f53\u4e24\u4e2a\u7ebf\u7a0b\u540c\u65f6\u901a\u8fc7 lock.lockInterruptibly()\u60f3\u83b7\u53d6\u67d0\u4e2a\u9501\u65f6\uff0c\u5047\u82e5\u6b64\u65f6\u7ebf\u7a0b A \u83b7\u53d6\u5230\u4e86\u9501\uff0c\u800c\u7ebf\u7a0b B \u53ea\u6709\u5728\u7b49\u5f85\uff0c\u90a3\u4e48\u5bf9\u7ebf\u7a0b B \u8c03\u7528 threadB.interrupt()\u65b9\u6cd5\u80fd\u591f\u4e2d\u65ad\u7ebf\u7a0b B \u7684\u7b49\u5f85\u8fc7\u7a0b\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u7531\u4e8e lockInterruptibly()\u7684\u58f0\u660e\u4e2d\u629b\u51fa\u4e86\u5f02\u5e38\uff0c \u6240\u4ee5 lock.lockInterruptibly()\u5fc5\u987b\u653e\u5728 try \u5757\u4e2d\u6216\u8005\u5728\u8c03\u7528 lockInterruptibly() \u7684\u65b9\u6cd5\u5916\u58f0\u660e\u629b\u51fa InterruptedException\u3002"}),"\n",(0,r.jsx)(e.p,{children:"lockInterruptibly()\u4f7f\u7528\u793a\u4f8b:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"public void function() throws InterruptedException {\n    Lock lock = new ReentrantLock();\n    lock.lockInterruptibly();\n    try {\n        \n    } catch (Exception e) {\n        e.printStackTrace();\n    } finally {\n        lock.unlock();\n    }\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.strong,{children:"\u6ce8\u610f\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u83b7\u53d6\u4e86\u9501\u4e4b\u540e\uff0c\u662f\u4e0d\u4f1a\u88ab interrupt()\u65b9\u6cd5\u4e2d\u65ad\u7684\u3002\u5355\u72ec\u8c03\u7528 interrupt()\u65b9\u6cd5\u4e0d\u80fd\u4e2d\u65ad\u6b63\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\u7684\u7ebf\u7a0b\uff0c\u53ea\u80fd\u4e2d\u65ad\u963b\u585e\u8fc7\u7a0b\u4e2d\u7684\u7ebf\u7a0b\u3002\u56e0\u6b64\u5f53\u901a\u8fc7 lockInterruptibly()\u65b9\u6cd5\u83b7\u53d6\u67d0\u4e2a\u9501\u65f6\uff0c\u5982\u679c\u4e0d\u80fd\u83b7\u53d6\u5230\uff0c\u53ea\u6709\u8fdb\u884c\u7b49\u5f85\u7684\u60c5\u51b5\u4e0b\uff0c\u662f\u53ef\u4ee5\u54cd\u5e94\u4e2d\u65ad\u7684\u3002\u800c\u7528 synchronized \u4fee\u9970\u7684\u8bdd\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u5904\u4e8e\u7b49\u5f85\u67d0\u4e2a\u9501\u7684\u72b6\u6001\uff0c\u662f\u65e0\u6cd5\u88ab\u4e2d\u65ad\u7684\uff0c\u53ea\u6709\u4e00\u76f4\u7b49\u5f85\u4e0b\u53bb\u3002"})}),"\n",(0,r.jsx)(e.p,{children:"unLock():\u91ca\u653e\u9501\nnewCondition():\u83b7\u53d6\u6761\u4ef6\u53d8\u91cf"}),"\n",(0,r.jsx)(e.h3,{id:"reentrantlock",children:"ReentrantLock"}),"\n",(0,r.jsx)(e.p,{children:"ReentrantLock \u610f\u601d\u662f\u201c\u53ef\u91cd\u5165\u9501\u201d\uff0cReentrantLock \u662f\u552f\u4e00\u5b9e\u73b0\u4e86 Lock \u63a5\u53e3\u7684\u7c7b\uff0c\u5e76\u4e14 ReentrantLock \u63d0\u4f9b\u4e86\u66f4\u591a\u7684\u65b9\u6cd5\u3002\u4e0b\u9762\u901a\u8fc7\u4e00\u4e9b\u5b9e\u4f8b\u770b\u5177\u4f53\u770b\u4e00\u4e0b\u5982\u4f55\u4f7f\u7528 ReentrantLock\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"\u793a\u4f8b",children:"\u793a\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class ReentrantLockTest {\n    private Lock lock = new ReentrantLock();\n    public static void main(String[] args) {\n        final ReentrantLockTest test = new ReentrantLockTest();\n        new Thread(new Runnable() {\n            public void run() {\n                test.method();\n            }\n        }).start();\n\n        new Thread(new Runnable() {\n            public void run() {\n                test.method();\n            }\n        }).start();\n\n    }\n\n    public void method() {\n        try {\n            lock.lock();\n            System.out.println(Thread.currentThread().getName() + " \u83b7\u5f97\u4e86\u9501! ");\n        } catch (Exception e) {\n            e.printStackTrace();\n        } finally {\n            System.out.println(Thread.currentThread().getName() + " \u91ca\u653e\u4e86\u9501! ");\n            lock.unlock();\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u8fd0\u884c\u7ed3\u679c:"}),"\n",(0,r.jsx)(e.p,{children:"Thread-0 \u83b7\u5f97\u4e86\u9501!\nThread-0 \u91ca\u653e\u4e86\u9501!\nThread-1 \u83b7\u5f97\u4e86\u9501!\nThread-1 \u91ca\u653e\u4e86\u9501!"}),"\n",(0,r.jsx)(e.h3,{id:"readwritelock-\u63a5\u53e3",children:"ReadWriteLock \u63a5\u53e3"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"public interface ReadWriteLock {\n    // Returns the lock used for reading.\n    Lock readLock();\n    // Returns the lock used for writing.\n    Lock writeLock();\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u4e00\u4e2a\u7528\u6765\u83b7\u53d6\u8bfb\u9501\uff0c\u4e00\u4e2a\u7528\u6765\u83b7\u53d6\u5199\u9501\u3002\u4e5f\u5c31\u662f\u8bf4\u5c06\u6587\u4ef6\u7684\u8bfb\u5199\u64cd\u4f5c\u5206\u5f00\uff0c\u5206\u6210 2 \u4e2a\u9501\u6765\u5206\u914d\u7ed9\u7ebf\u7a0b\uff0c\u4ece\u800c\u4f7f\u5f97\u591a\u4e2a\u7ebf\u7a0b\u53ef\u4ee5\u540c\u65f6\u8fdb\u884c\u8bfb\u64cd\u4f5c\u3002"}),"\n",(0,r.jsx)(e.h4,{id:"\u793a\u4f8b-1",children:"\u793a\u4f8b"}),"\n",(0,r.jsx)(e.p,{children:"\u5728\u7ebf\u6587\u4ef6\u7f16\u8f91\u5668\u3002\u540c\u4e00\u4efd\u6587\u4ef6\uff0c\u4e00\u4e2a\u4eba\u5728\u8bfb\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u4eba\u4e0d\u80fd\u5199\uff0c\u591a\u4eba\u53ef\u4ee5\u540c\u65f6\u8bfb\uff1b\u540c\u7406\uff0c\u4e00\u4e2a\u4eba\u5728\u5199\u7684\u65f6\u5019\uff0c\u5176\u4ed6\u4eba\u4e5f\u4e0d\u80fd\u8bfb\uff0c\u540c\u4e00\u65f6\u523b\u53ea\u80fd\u6709\u4e00\u4e2a\u4eba\u5199\u3002\n\u6570\u636e\u7c7b Data:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"public class Data {\n    private final char[] buffer;\n\n    private final SelfReadWriteLock lock = new SelfReadWriteLock();\n\n    public Data(int size){\n        buffer = new char[size];\n        for (int i = 0; i < size; ++i){\n            buffer[i] = '*';\n        }\n    }\n\n    public String read() throws InterruptedException {\n        lock.readLock(); //\u8bfb\u53d6\u4e0a\u9501\n        try {\n            return doRead(); //\u8bfb\u53d6\u6570\u636e\n        } finally {\n            lock.readUnlock();\n        }\n    }\n\n    public String doRead() {\n        StringBuffer str = new StringBuffer();\n        for (int i = 0; i < buffer.length; ++i){\n            str.append(buffer[i]);\n        }\n        sleep(100);\n        return str.toString();\n    }\n\n    public void write(char c) throws InterruptedException {\n        lock.writeLock();\n        try {\n            doWrite(c);\n        } finally {\n            lock.writeUnlock();\n        }\n    }\n\n    public void doWrite(char c){\n        for (int i = 0; i < buffer.length; ++i){\n            buffer[i] = c;\n            sleep(100);\n        }\n    }\n\n    public void sleep(long ms){\n        try {\n            Thread.sleep(ms);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u81ea\u5b9a\u4e49\u8bfb\u5199\u9501:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"package me.ilcb.java.readwrite;\npublic class SelfReadWriteLock {\n    private int readThreadCounter = 0;      // \u6b63\u5728\u8bfb\u53d6\u7684\u8fdb\u7a0b\u6570 (0\u4e2a\u6216\u591a\u4e2a)\n    private int waitingWriteCounter = 0;    // \u7b49\u5f85\u5199\u5165\u7684\u7ebf\u7a0b\u6570 (0\u4e2a\u6216\u591a\u4e2a)\n    private int writeThreadCounter = 0;     // \u6b63\u5728\u5199\u5165\u7684\u53bf\u57ce\u6570 (0\u4e2a\u6216\u591a\u4e2a)\n    private boolean writeFlag = true;       // \u662f\u5426\u5199\u5165\u4f18\u5148 (\u9ed8\u8ba4\u4e3a\u662f)\n\n    // \u8bfb\u53d6\u67b7\u9501\n    public synchronized void readLock() throws InterruptedException {\n        // \u82e5\u5b58\u5728\u6b63\u5728\u5199\u5165\u7684\u7ebf\u7a0b\uff0c\u6216\u5f53\u524d\u5199\u5165\u4f18\u5148\u65f6\u5b58\u5728\u7b49\u5f85\u5199\u5165\u7684\u7ebf\u7a0b\uff0c\u5219\u5c06\u5f53\u524d\u7ebf\u7a0b\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\n        while(writeThreadCounter > 0 || (writeFlag && waitingWriteCounter > 0)){\n            wait();\n        }\n\n        // \u4f7f\u6b63\u5728\u8bfb\u53d6\u7684\u7ebf\u7a0b\u6570\u52a0\u4e00\n        readThreadCounter++;\n    }\n\n    // \u8bfb\u53d6\u89e3\u9501\n    public synchronized void readUnlock(){\n         //\u6b63\u5728\u8bfb\u53d6\u7684\u7ebf\u7a0b\u6570\u51cf1\n        readThreadCounter--;\n\n        // \u8bfb\u53d6\u7ed3\u675f\uff0c\u5199\u5165\u4f18\u5148\n        writeFlag = true;\n\n        //\u901a\u77e5\u6240\u6709\u5904\u4e8ewait\u72b6\u6001\u7684\u7ebf\u7a0b\n        notifyAll();\n    }\n\n    // \u5199\u5165\u52a0\u9501\n    public synchronized void writeLock() throws InterruptedException {\n        //\u7b49\u5f85\u5199\u5165\u7684\u7ebf\u7a0b\u6570\u52a01\n        waitingWriteCounter++;\n\n        try {\n            //\u82e5\u5b58\u5728\u6b63\u5728\u8bfb\u53d6\u7684\u7ebf\u7a0b\uff0c\u6216\u5b58\u5728\u6b63\u5728\u5199\u5165\u7684\u7ebf\u7a0b\uff0c\u5c06\u5f53\u524d\u7ebf\u7a0b\u8bbe\u7f6e\u4e3a\u7b49\u5f85\u72b6\u6001\n            while (readThreadCounter > 0 || writeThreadCounter > 0) {\n                wait();\n            }\n        } catch (Exception e) {\n            // \u7b49\u5f85\u5199\u5165\u7684\u7ebf\u7a0b\u6570\u51cf1\n            waitingWriteCounter--;\n        }\n        // \u6b63\u5728\u5199\u5165\u7684\u7ebf\u7a0b\u6570\u52a01\n        writeThreadCounter++;\n    }\n\n    // \u5199\u5165\u89e3\u9501\n    public synchronized void writeUnlock() {\n        // \u6b63\u5728\u5199\u5165\u7684\u7ebf\u7a0b\u6570\u51cf1\n        writeThreadCounter--;\n        //\u5199\u5165\u7ed3\u675f\uff0c\u8bfb\u53d6\u4f18\u5148\n        writeFlag = false;\n\n        //\u901a\u77e5\u6240\u6709\u5904\u4e8ewait\u72b6\u6001\u7684\u7ebf\u7a0b\n        notifyAll();\n    }\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u6a21\u62df\u8bfb\u7ebf\u7a0b:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'public class ReadThread extends Thread {\n    private final Data data;\n\n    public ReadThread(Data data){\n        this.data = data;\n    }\n\n    public void run(){\n        while(true){\n            long begin = System.currentTimeMillis();\n\n            for (int i = 0; i < 10; i++) {\n                String result = null;\n                try {\n                    result = data.read();\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n                System.out.println(Thread.currentThread().getName() + " => " + result);\n            }\n            long time = System.currentTimeMillis() - begin;\n            System.out.println(Thread.currentThread().getName() + " -- " + time + "ms");\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u6a21\u62df\u5199\u7ebf\u7a0b:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"public class WriteThread extends Thread {\n    private Data data;\n    private String str;\n    private int index = 0;\n\n    public WriteThread(Data data, String str){\n        this.data = data;\n        this.str = str;\n    }\n\n    public void run(){\n        while(true){\n            char c = next();\n            try {\n                data.write(c);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n        }\n    }\n\n    public char next(){\n        char c = str.charAt(index);\n        index++;\n        if (index > str.length() - 1){\n            index = 0;\n        }\n        return c;\n    }\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u6d4b\u8bd5:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'public class Client {\n    public static void main(String[] args){\n        Data data = new Data(10);\n\n        new ReadThread(data).start();\n        new ReadThread(data).start();\n        new ReadThread(data).start();\n        new ReadThread(data).start();\n        new ReadThread(data).start();\n\n        new WriteThread(data, "ABCDEF").start();\n        new WriteThread(data, "123456").start();\n    }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u57fa\u4e8e Java ReadWriteLock \u5b9e\u73b0\u53ea\u9700\u8981\u4fee\u6539 Data:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"public class Data {\n   private final char[] buffer;\n\n    private final ReadWriteLock lock = new ReentrantReadWriteLock(); // \u521b\u5efa\u8bfb\u5199\u9501\n    private final Lock readLock = lock.readLock();    // \u83b7\u53d6\u8bfb\u9501\n    private final Lock writeLock = lock.writeLock();  // \u83b7\u53d6\u5199\u9501\n\n    public Data(int size){\n        buffer = new char[size];\n        for (int i = 0; i < size; ++i){\n            buffer[i] = '*';\n        }\n    }\n\n    public String read() throws InterruptedException {\n        readLock.lock(); //\u8bfb\u53d6\u4e0a\u9501\n        try {\n            return doRead(); //\u8bfb\u53d6\u6570\u636e\n        } finally {\n            readLock.unlock();\n        }\n    }\n\n    public String doRead() {\n        StringBuffer str = new StringBuffer();\n        for (int i = 0; i < buffer.length; ++i){\n            str.append(buffer[i]);\n        }\n        sleep(100);\n        return str.toString();\n    }\n\n    public void write(char c) throws InterruptedException {\n        writeLock.lock();\n        try {\n            doWrite(c);\n        } finally {\n            writeLock.unlock();\n        }\n    }\n\n    public void doWrite(char c){\n        for (int i = 0; i < buffer.length; ++i){\n            buffer[i] = c;\n            sleep(100);\n        }\n    }\n\n    public void sleep(long ms){\n        try {\n            Thread.sleep(ms);\n        } catch (InterruptedException e) {\n            e.printStackTrace();\n        }\n    }\n}\n"})}),"\n",(0,r.jsx)(e.h3,{id:"reentrantreadwritelock",children:"ReentrantReadWriteLock"}),"\n",(0,r.jsxs)(e.p,{children:["\u5b9e\u73b0\u4e86 ReadWriteLock \u63a5\u53e3",":readLock","()\u548c writeLock()\u7528\u6765\u83b7\u53d6\u8bfb\u9501\u548c\u5199\u9501\u3002"]}),"\n",(0,r.jsx)(e.h3,{id:"lock-\u548c-synchronized-\u7684\u9009\u62e9",children:"Lock \u548c synchronized \u7684\u9009\u62e9"}),"\n",(0,r.jsx)(e.p,{children:"Lock \u548c synchronized \u6709\u4ee5\u4e0b\u51e0\u70b9\u4e0d\u540c:"}),"\n",(0,r.jsxs)(e.ol,{children:["\n",(0,r.jsx)(e.li,{children:"Lock \u662f\u4e00\u4e2a\u63a5\u53e3\uff0c\u800c synchronized \u662f Java \u4e2d\u7684\u5173\u952e\u5b57\uff0csynchronized \u662f\u5185\u7f6e\u7684\u8bed\u8a00\u5b9e\u73b0\uff1b"}),"\n",(0,r.jsx)(e.li,{children:"synchronized \u5728\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u4f1a\u81ea\u52a8\u91ca\u653e\u7ebf\u7a0b\u5360\u6709\u7684\u9501\uff0c\u56e0\u6b64\u4e0d\u4f1a\u5bfc\u81f4\u6b7b\u9501\u73b0\u8c61\u53d1\u751f\uff1b\u800c Lock \u5728\u53d1\u751f\u5f02\u5e38\u65f6\uff0c\u5982\u679c\u6ca1\u6709\u4e3b\u52a8\u901a\u8fc7 unLock()\u53bb\u91ca\u653e\u9501\uff0c\u5219\u5f88\u53ef\u80fd\u9020\u6210\u6b7b\u9501\u73b0\u8c61\uff0c\u56e0\u6b64\u4f7f\u7528 Lock \u65f6\u9700\u8981\u5728 finally \u5757\u4e2d\u91ca\u653e\u9501\uff1b"}),"\n",(0,r.jsx)(e.li,{children:"Lock \u53ef\u4ee5\u8ba9\u7b49\u5f85\u9501\u7684\u7ebf\u7a0b\u54cd\u5e94\u4e2d\u65ad\uff0c\u800c synchronized \u5374\u4e0d\u884c\uff0c\u4f7f\u7528 synchronized \u65f6\uff0c\u7b49\u5f85\u7684\u7ebf\u7a0b\u4f1a\u4e00\u76f4\u7b49\u5f85\u4e0b\u53bb\uff0c\u4e0d\u80fd\u591f\u54cd\u5e94\u4e2d\u65ad\uff1b"}),"\n",(0,r.jsx)(e.li,{children:"\u901a\u8fc7 Lock \u53ef\u4ee5\u77e5\u9053\u6709\u6ca1\u6709\u6210\u529f\u83b7\u53d6\u9501\uff0c\u800c synchronized \u5374\u65e0\u6cd5\u529e\u5230\uff1b"}),"\n",(0,r.jsx)(e.li,{children:"Lock \u53ef\u4ee5\u63d0\u9ad8\u591a\u4e2a\u7ebf\u7a0b\u8fdb\u884c\u8bfb\u64cd\u4f5c\u7684\u6548\u7387\uff1b\n\u5728\u6027\u80fd\u4e0a\u6765\u8bf4\uff0c\u5982\u679c\u7ade\u4e89\u8d44\u6e90\u4e0d\u6fc0\u70c8\uff0c\u4e24\u8005\u7684\u6027\u80fd\u662f\u5dee\u4e0d\u591a\u7684\uff0c\u800c\u5f53\u7ade\u4e89\u8d44\u6e90\u975e\u5e38\u6fc0\u70c8\u65f6\uff08\u5373\u6709\u5927\u91cf\u7ebf\u7a0b\u540c\u65f6\u7ade\u4e89\uff09\uff0c\u6b64\u65f6 Lock \u7684\u6027\u80fd\u8981\u8fdc\u8fdc\u4f18\u4e8e synchronized\u3002\u6240\u4ee5\u8bf4\uff0c\u5728\u5177\u4f53\u4f7f\u7528\u65f6\u8981\u6839\u636e\u9002\u5f53\u60c5\u51b5\u9009\u62e9\u3002"}),"\n"]}),"\n",(0,r.jsx)(e.h2,{id:"condition",children:"Condition"}),"\n",(0,r.jsx)(e.h3,{id:"\u6761\u4ef6\u53d8\u91cf-condition",children:"\u6761\u4ef6\u53d8\u91cf Condition"}),"\n",(0,r.jsx)(e.p,{children:'Condition \u7684\u4f5c\u7528\u662f\u5bf9\u9501\u8fdb\u884c\u66f4\u7cbe\u786e\u7684\u63a7\u5236\uff0cCondition \u4e2d\u7684 await()\u65b9\u6cd5\u76f8\u5f53\u4e8e Object \u7684 wait()\u65b9\u6cd5\uff0cCondition \u4e2d\u7684 signal()\u65b9\u6cd5\u76f8\u5f53\u4e8e Object \u7684 notify()\u65b9\u6cd5\uff0cCondition \u4e2d\u7684 signalAll()\u76f8\u5f53\u4e8e Object \u7684 notifyAll()\u65b9\u6cd5\u3002\u4e0d\u540c\u7684\u662f\uff0cObject \u4e2d\u7684 wait(),notify(),notifyAll()\u65b9\u6cd5\u662f\u548c"\u540c\u6b65\u9501"(synchronized)\u6346\u7ed1\u4f7f\u7528\u7684\uff1b\u800c Condition \u662f\u9700\u8981\u4e0e"\u4e92\u65a5\u9501"/"\u5171\u4eab\u9501"(Lock)\u6346\u7ed1\u4f7f\u7528\u7684\u3002'}),"\n",(0,r.jsxs)(e.p,{children:["Condition\uff08\u4e5f\u79f0\u4e3a\u6761\u4ef6\u961f\u5217\u6216\u6761\u4ef6\u53d8\u91cf\uff09\u4e3a\u7ebf\u7a0b\u63d0\u4f9b\u4e86\u4e00\u4e2a\u542b\u4e49\uff0c\u4ee5\u4fbf\u5728\u67d0\u4e2a\u72b6\u6001\u6761\u4ef6\u73b0\u5728\u53ef\u80fd\u4e3a true \u7684\u53e6\u4e00\u4e2a\u7ebf\u7a0b\u901a\u77e5\u5b83\u4e4b\u524d\uff0c\u4e00\u76f4\u6302\u8d77\u8be5\u7ebf\u7a0b\uff08\u5373\u8ba9\u5176\u201c\u7b49\u5f85\u201d\uff09\u3002\u56e0\u4e3a\u8bbf\u95ee\u6b64\u5171\u4eab\u72b6\u6001\u4fe1\u606f\u53d1\u751f\u5728\u4e0d\u540c\u7684\u7ebf\u7a0b\u4e2d\uff0c\u6240\u4ee5\u5b83\u5fc5\u987b\u53d7\u4fdd\u62a4\uff0c\u56e0\u6b64\u8981\u5c06\u67d0\u79cd\u5f62\u5f0f\u7684\u9501\u4e0e\u8be5\u6761\u4ef6\u76f8\u5173\u8054\u3002\u7b49\u5f85\u63d0\u4f9b\u4e00\u4e2a\u6761\u4ef6\u7684\u4e3b\u8981\u5c5e\u6027\u662f:\u4ee5\u539f\u5b50\u65b9\u5f0f\u91ca\u653e\u76f8\u5173\u7684\u9501\uff0c\u5e76\u6302\u8d77\u5f53\u524d\u7ebf\u7a0b\uff0c\u5c31\u50cf",(0,r.jsx)(e.code,{children:"Object.wait()"}),"\u505a\u7684\u90a3\u6837\u3002"]}),"\n",(0,r.jsx)(e.p,{children:"\u6761\u4ef6\u53d8\u91cf\u9700\u8981\u4e0e\u9501\u7ed1\u5b9a\uff0c\u800c\u4e14\u591a\u4e2a Condition \u9700\u8981\u7ed1\u5b9a\u5230\u540c\u4e00\u9501\u4e0a\uff0c\u83b7\u53d6\u4e00\u4e2a\u6761\u4ef6\u53d8\u91cf\u7684\u65b9\u6cd5\u662f Lock.newCondition()\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"condition-\u65b9\u6cd5",children:"Condition \u65b9\u6cd5"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"public interface Condition \n    /**\n     * \u4f7f\u5f53\u524d\u7ebf\u7a0b\u5728\u63a5\u5230\u4fe1\u53f7\u6216\u88ab\u4e2d\u65ad\u4e4b\u524d\u4e00\u76f4\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\n     * \u4e0e\u6b64Condition \u76f8\u5173\u7684\u9501\u4ee5\u539f\u5b50\u65b9\u5f0f\u91ca\u653e\uff0c\u5e76\u4e14\u51fa\u4e8e\u7ebf\u7a0b\u8c03\u5ea6\u7684\u76ee\u7684\uff0c\u5c06\u7981\u7528\u5f53\u524d\u7ebf\u7a0b\uff0c\u4e14\u5728\u53d1\u751f\u4ee5\u4e0b\u56db\u79cd\u60c5\u51b5\u4e4b\u4e00\u4ee5\u524d\uff0c\u5f53\u524d\u7ebf\u7a0b\u5c06\u4e00\u76f4\u5904\u4e8e\u4f11\u7720\u72b6\u6001:\n\t * \u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u8c03\u7528\u6b64Condition\u7684signal()\u65b9\u6cd5\uff0c\u5e76\u4e14\u78b0\u5de7\u5c06\u5f53\u524d\u7ebf\u7a0b\u9009\u4e3a\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\uff1b\n\t * \u6216\u8005\u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u8c03\u7528\u6b64Condition\u7684signalAll()\u65b9\u6cd5\uff1b\n\t * \u6216\u8005\u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u4e2d\u65ad\u5f53\u524d\u7ebf\u7a0b\uff0c\u4e14\u652f\u6301\u4e2d\u65ad\u7ebf\u7a0b\u7684\u6302\u8d77\uff1b\n\t * \u6216\u8005\u53d1\u751f\u201c\u865a\u5047\u5524\u9192\u201d\n     * \u5728\u6240\u6709\u60c5\u51b5\u4e0b\uff0c\u5728\u6b64\u65b9\u6cd5\u53ef\u4ee5\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u4e4b\u524d\uff0c\u90fd\u5fc5\u987b\u91cd\u65b0\u83b7\u53d6\u4e0e\u6b64\u6761\u4ef6\u6709\u5173\u7684\u9501\u3002\u5728\u7ebf\u7a0b\u8fd4\u56de\u65f6\uff0c\u53ef\u4ee5\u4fdd\u8bc1 \u5b83\u4fdd\u6301\u6b64\u9501\u3002\n     */\n    void await() throws InterruptedException;\n\n    /**\n     * \u4f7f\u5f53\u524d\u7ebf\u7a0b\u5728\u63a5\u5230\u4fe1\u53f7\u4e4b\u524d\u4e00\u76f4\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\n     * \u4e0e\u6b64Condition\u76f8\u5173\u7684\u9501\u4ee5\u539f\u5b50\u65b9\u5f0f\u91ca\u653e\uff0c\u5e76\u4e14\u51fa\u4e8e\u7ebf\u7a0b\u8c03\u5ea6\u7684\u76ee\u7684\uff0c\u5c06\u7981\u7528\u5f53\u524d\u7ebf\u7a0b\uff0c\u4e14\u5728\u53d1\u751f\u4ee5\u4e0b\u4e09\u79cd\u60c5\u51b5\u4e4b\u4e00\u4ee5\u524d\uff0c\u5f53\u524d\u7ebf\u7a0b\u5c06\u4e00\u76f4\u5904\u4e8e\u4f11\u7720\u72b6\u6001:\n\t * \u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u8c03\u7528\u6b64Condition\u7684signal()\u65b9\u6cd5\uff0c\u5e76\u4e14\u78b0\u5de7\u5c06\u5f53\u524d\u7ebf\u7a0b\u9009\u4e3a\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\uff1b\n\t * \u6216\u8005\u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u8c03\u7528\u6b64Condition\u7684signalAll()\u65b9\u6cd5\uff1b\n\t * \u6216\u8005\u53d1\u751f\u201c\u865a\u5047\u5524\u9192\u201d\n\t * \u5728\u6240\u6709\u60c5\u51b5\u4e0b\uff0c\u5728\u6b64\u65b9\u6cd5\u53ef\u4ee5\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u4e4b\u524d\uff0c\u90fd\u5fc5\u987b\u91cd\u65b0\u83b7\u53d6\u4e0e\u6b64\u6761\u4ef6\u6709\u5173\u7684\u9501\u3002\u5728\u7ebf\u7a0b\u8fd4\u56de\u65f6\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5b83\u4fdd\u6301\u6b64\u9501\u3002\n     */\n    void awaitUninterruptibly();\n\n    /**\n     * \u4f7f\u5f53\u524d\u7ebf\u7a0b\u5728\u63a5\u5230\u4fe1\u53f7\u3001\u88ab\u4e2d\u65ad\u6216\u5230\u8fbe\u6307\u5b9a\u7b49\u5f85\u65f6\u95f4\u4e4b\u524d\u4e00\u76f4\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002\n     * \u4e0e\u6b64Condition\u76f8\u5173\u7684\u9501\u4ee5\u539f\u5b50\u65b9\u5f0f\u91ca\u653e\uff0c\u5e76\u4e14\u51fa\u4e8e\u7ebf\u7a0b\u8c03\u5ea6\u7684\u76ee\u7684\uff0c\u5c06\u7981\u7528\u5f53\u524d\u7ebf\u7a0b\uff0c\u4e14\u5728\u53d1\u751f\u4ee5\u4e0b\u4e94\u79cd\u60c5\u51b5\u4e4b\u4e00\u4ee5\u524d\uff0c\u5f53\u524d\u7ebf\u7a0b\u5c06\u4e00\u76f4\u5904\u4e8e\u4f11\u7720\u72b6\u6001:\n     * \u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u8c03\u7528\u6b64Condition\u7684signal()\u65b9\u6cd5\uff0c\u5e76\u4e14\u78b0\u5de7\u5c06\u5f53\u524d\u7ebf\u7a0b\u9009\u4e3a\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\uff1b\n     * \u6216\u8005\u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u8c03\u7528\u6b64Condition\u7684signalAll()\u65b9\u6cd5\uff1b\n     * \u6216\u8005\u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u4e2d\u65ad\u5f53\u524d\u7ebf\u7a0b\uff0c\u4e14\u652f\u6301\u4e2d\u65ad\u7ebf\u7a0b\u7684\u6302\u8d77\uff1b\n     * \u6216\u8005\u5df2\u8d85\u8fc7\u6307\u5b9a\u7684\u7b49\u5f85\u65f6\u95f4\uff1b\n     * \u6216\u8005\u53d1\u751f\u201c\u865a\u5047\u5524\u9192\u201d\u3002\n\t * \u5728\u6240\u6709\u60c5\u51b5\u4e0b\uff0c\u5728\u6b64\u65b9\u6cd5\u53ef\u4ee5\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u4e4b\u524d\uff0c\u90fd\u5fc5\u987b\u91cd\u65b0\u83b7\u53d6\u4e0e\u6b64\u6761\u4ef6\u6709\u5173\u7684\u9501\u3002\u5728\u7ebf\u7a0b\u8fd4\u56de\u65f6\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5b83\u4fdd\u6301\u6b64\u9501\u3002\n     */\n    long awaitNanos(long nanosTimeout) throws InterruptedException;\n\n    /**\n     * \u5b9e\u9645\u4e0a\u5c31\u662f\u91ca\u653e\u9501\uff0c\u7136\u540e\u6302\u8d77\u7ebf\u7a0b\uff0c\u4e00\u65e6\u6761\u4ef6\u6ee1\u8db3\u5c31\u88ab\u5524\u9192\uff0c\u518d\u6b21\u83b7\u53d6\u9501\n     */\n    boolean await(long time, TimeUnit unit) throws InterruptedException;\n\n    /**\n     * \u9020\u6210\u5f53\u524d\u7ebf\u7a0b\u5728\u63a5\u5230\u4fe1\u53f7\u3001\u88ab\u4e2d\u65ad\u6216\u5230\u8fbe\u6307\u5b9a\u6700\u540e\u671f\u9650\u4e4b\u524d\u4e00\u76f4\u5904\u4e8e\u7b49\u5f85\u72b6\u6001\u3002\n\t * \u4e0e\u6b64Condition\u76f8\u5173\u7684\u9501\u4ee5\u539f\u5b50\u65b9\u5f0f\u91ca\u653e\uff0c\u5e76\u4e14\u51fa\u4e8e\u7ebf\u7a0b\u8c03\u5ea6\u7684\u76ee\u7684\uff0c\u5c06\u7981\u7528\u5f53\u524d\u7ebf\u7a0b\uff0c\u4e14\u5728\u53d1\u751f\u4ee5\u4e0b\u4e94\u79cd\u60c5\u51b5\u4e4b\u4e00\u4ee5\u524d\uff0c\u5f53\u524d\u7ebf\u7a0b\u5c06\u4e00\u76f4\u5904\u4e8e\u4f11\u7720\u72b6\u6001:\n     * \u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u8c03\u7528\u6b64Condition\u7684signal()\u65b9\u6cd5\uff0c\u5e76\u4e14\u78b0\u5de7\u5c06\u5f53\u524d\u7ebf\u7a0b\u9009\u4e3a\u88ab\u5524\u9192\u7684\u7ebf\u7a0b\uff1b\n     * \u6216\u8005\u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u8c03\u7528\u6b64Condition\u7684signalAll()\u65b9\u6cd5\uff1b\n     * \u6216\u8005\u5176\u4ed6\u67d0\u4e2a\u7ebf\u7a0b\u4e2d\u65ad\u5f53\u524d\u7ebf\u7a0b\uff0c\u4e14\u652f\u6301\u4e2d\u65ad\u7ebf\u7a0b\u7684\u6302\u8d77\uff1b\n     * \u6216\u8005\u6307\u5b9a\u7684\u6700\u540e\u671f\u9650\u5230\u4e86\uff1b\n     * \u6216\u8005\u53d1\u751f\u201c\u865a\u5047\u5524\u9192\u201d\u3002\n\t * \u5728\u6240\u6709\u60c5\u51b5\u4e0b\uff0c\u5728\u6b64\u65b9\u6cd5\u53ef\u4ee5\u8fd4\u56de\u5f53\u524d\u7ebf\u7a0b\u4e4b\u524d\uff0c\u90fd\u5fc5\u987b\u91cd\u65b0\u83b7\u53d6\u4e0e\u6b64\u6761\u4ef6\u6709\u5173\u7684\u9501\u3002\u5728\u7ebf\u7a0b\u8fd4\u56de\u65f6\uff0c\u53ef\u4ee5\u4fdd\u8bc1\u5b83\u4fdd\u6301\u6b64\u9501\u3002\n     */\n    boolean awaitUntil(Date deadline) throws InterruptedException;\n\n    /**\n     * \u5524\u9192\u4e00\u4e2a\u7b49\u5f85\u7ebf\u7a0b\u3002\n\t * \u5982\u679c\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u5728\u7b49\u5f85\u6b64\u6761\u4ef6\uff0c\u5219\u9009\u62e9\u5176\u4e2d\u7684\u4e00\u4e2a\u5524\u9192\u3002\u5728\u4eceawait\u8fd4\u56de\u4e4b\u524d\uff0c\u8be5\u7ebf\u7a0b\u5fc5\u987b\u91cd\u65b0\u83b7\u53d6\u9501\n     */\n    void signal();\n\n    /**\n     * \u5524\u9192\u6240\u6709\u7b49\u5f85\u7ebf\u7a0b\u3002\n     * \u5982\u679c\u6240\u6709\u7684\u7ebf\u7a0b\u90fd\u5728\u7b49\u5f85\u6b64\u6761\u4ef6\uff0c\u5219\u5524\u9192\u6240\u6709\u7ebf\u7a0b\u3002\u5728\u4eceawait\u8fd4\u56de\u4e4b\u524d\uff0c\u6bcf\u4e2a\u7ebf\u7a0b\u90fd\u5fc5\u987b\u91cd\u65b0\u83b7\u53d6\u9501\n     */\n    void signalAll();\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u6bcf\u4e00\u4e2a Lock \u53ef\u4ee5\u6709\u4efb\u610f\u6570\u636e\u7684 Condition \u5bf9\u8c61\uff0cCondition \u662f\u4e0e Lock \u7ed1\u5b9a\u7684\uff0c\u6240\u4ee5\u5c31\u6709 Lock \u7684\u516c\u5e73\u6027\u7279\u6027:\u5982\u679c\u662f\u516c\u5e73\u9501\uff0c\u7ebf\u7a0b\u4e3a\u6309\u7167 FIFO \u7684\u987a\u5e8f\u4ece Condition.await \u4e2d\u91ca\u653e\uff0c\u5982\u679c\u662f\u975e\u516c\u5e73\u9501\uff0c\u90a3\u4e48\u540e\u7eed\u7684\u9501\u7ade\u4e89\u5c31\u4e0d\u4fdd\u8bc1 FIFO \u987a\u5e8f\u4e86\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"condition-\u5b9e\u73b0\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u793a\u4f8b",children:"Condition \u5b9e\u73b0\u751f\u4ea7\u8005\u6d88\u8d39\u8005\u793a\u4f8b"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'import java.util.concurrent.locks.Condition;\nimport java.util.concurrent.locks.Lock;\nimport java.util.concurrent.locks.ReentrantLock;\n\npublic class ProductQueue<T> {\n    private final T[] items;\n\n    private final Lock lock = new ReentrantLock();\n    private Condition notFull = lock.newCondition();\n    private Condition notEmpty = lock.newCondition();\n\n    private int head, tail, count;\n\n    public ProductQueue(int maxSize) {\n        items = (T[]) new Object[maxSize];\n    }\n\n    public ProductQueue() {\n        this(10);\n    }\n\n    public void put(T ele) throws InterruptedException {\n        lock.lock();\n        try {\n            // \u5982\u679c\u7f13\u51b2\u5df2\u6ee1\uff0c\u5219\u7b49\u5f85\uff1b\u76f4\u5230\u7f13\u51b2\u4e0d\u662f\u6ee1\u7684\uff0c\u5c06ele\u6dfb\u52a0\u5230\u7f13\u51b2\u4e2d\n            while (count == items.length) {\n                System.out.println("\u7f13\u51b2\u533a\u5df2\u6ee1\uff0c\u8bf7\u7b49\u5f85!");\n                notFull.await();\n            }\n\n            items[tail] = ele;\n            if (++tail == items.length) {\n                tail = 0;\n            }\n            ++count;\n\n            // \u5524\u9192take\u7ebf\u7a0b\uff0c\u56e0\u4e3atake\u7ebf\u7a0b\u901a\u8fc7notEmpty.await()\u7b49\u5f85\n            notEmpty.signalAll();\n        } finally {\n            lock.unlock();\n        }\n    }\n\n    public T take() throws InterruptedException {\n        lock.lock();\n        try {\n            // \u5982\u679c\u7f13\u51b2\u4e3a\u7a7a\uff0c\u5219\u7b49\u5f85,\u76f4\u5230\u7f13\u51b2\u4e0d\u4e3a\u7a7a\uff0c\u5c06ele\u4ece\u7f13\u51b2\u4e2d\u53d6\u51fa\u3002\n            while (count == 0) {\n                System.out.println("\u6ca1\u6709\u5143\u7d20\uff0c\u8bf7\u7b49\u5f85");\n                notEmpty.await();\n            }\n            T ele = items[head];\n            items[head] = null;\n\n            if (++head == items.length) {\n                head = 0;\n            }\n            --count;\n\n            // \u5524\u9192put\u7ebf\u7a0b\uff0c\u56e0\u4e3aput\u7ebf\u7a0b\u901a\u8fc7notFull.await()\u7b49\u5f85\n            notFull.signalAll();\n            return ele;\n        } finally {\n            lock.unlock();\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'public class PutTakeTest {\n    private static ProductQueue<Integer> queue = new ProductQueue<Integer>();\n\n    public static void main(String[] args) {\n        for (int i = 0; i < 5; ++i) {\n            new PutThread("p" + i, i).start();\n            new TakeThread("t" + i).start();\n        }\n    }\n\n    static class PutThread extends Thread {\n        private int num;\n\n        public PutThread(String name, int num) {\n            super(name);\n            this.num = num;\n        }\n\n        public void run() {\n            try {\n                queue.put(num);\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(Thread.currentThread().getName() + " put " + num);\n        }\n    }\n\n    static class TakeThread extends Thread {\n        public TakeThread(String name) {\n            super(name);\n        }\n\n        public void run() {\n            int ele = 0;\n            try {\n                ele = queue.take();\n            } catch (InterruptedException e) {\n                e.printStackTrace();\n            }\n            System.out.println(Thread.currentThread().getName() + " take " + ele);\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u67d0\u6b21\u8fd0\u884c\u7ed3\u679c:"}),"\n",(0,r.jsx)(e.p,{children:"p0 put 0\nt0 take 0\n\u6ca1\u6709\u5143\u7d20\uff0c\u8bf7\u7b49\u5f85\n\u6ca1\u6709\u5143\u7d20\uff0c\u8bf7\u7b49\u5f85\n\u6ca1\u6709\u5143\u7d20\uff0c\u8bf7\u7b49\u5f85\np2 put 2\nt1 take 2\n\u6ca1\u6709\u5143\u7d20\uff0c\u8bf7\u7b49\u5f85\n\u6ca1\u6709\u5143\u7d20\uff0c\u8bf7\u7b49\u5f85\np4 put 4\n\u6ca1\u6709\u5143\u7d20\uff0c\u8bf7\u7b49\u5f85\nt2 take 4\n\u6ca1\u6709\u5143\u7d20\uff0c\u8bf7\u7b49\u5f85\np1 put 1\n\u6ca1\u6709\u5143\u7d20\uff0c\u8bf7\u7b49\u5f85\nt3 take 1\np3 put 3\nt4 take 3"}),"\n",(0,r.jsx)(e.h2,{id:"\u9501\u7684\u6982\u5ff5",children:"\u9501\u7684\u6982\u5ff5"}),"\n",(0,r.jsx)(e.h3,{id:"\u53ef\u91cd\u5165\u9501",children:"\u53ef\u91cd\u5165\u9501"}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u9501\u5177\u5907\u53ef\u91cd\u5165\u6027\uff0c\u5219\u79f0\u4f5c\u4e3a\u53ef\u91cd\u5165\u9501\u3002\u50cf synchronized \u548c ReentrantLock \u90fd\u662f\u53ef\u91cd\u5165\u9501\uff0c\u53ef\u91cd\u5165\u6027\u5b9e\u9645\u4e0a\u8868\u660e\u4e86\u9501\u7684\u5206\u914d\u673a\u5236:\u57fa\u4e8e\u7ebf\u7a0b\u7684\u5206\u914d\uff0c\u800c\u4e0d\u662f\u57fa\u4e8e\u65b9\u6cd5\u8c03\u7528\u7684\u5206\u914d\u3002\u4e3e\u4e2a\u7b80\u5355\u7684\u4f8b\u5b50\uff0c\u5f53\u4e00\u4e2a\u7ebf\u7a0b\u6267\u884c\u5230\u67d0\u4e2a synchronized \u65b9\u6cd5\u65f6\uff0c\u6bd4\u5982\u8bf4 method1\uff0c\u5728 method1 \u4e2d\u4f1a\u8c03\u7528\u53e6\u5916\u4e00\u4e2a synchronized \u65b9\u6cd5 method2\uff0c\u6b64\u65f6\u7ebf\u7a0b\u4e0d\u5fc5\u91cd\u65b0\u53bb\u7533\u8bf7\u9501\uff0c\u800c\u662f\u53ef\u4ee5\u76f4\u63a5\u6267\u884c\u65b9\u6cd5 method2\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u539f\u7406\u4e0a\u5b83\u6709\u4e00\u4e2a\u4e0e\u9501\u76f8\u5173\u7684\u83b7\u53d6\u8ba1\u6570\u5668\uff0c\u5982\u679c\u62e5\u6709\u9501\u7684\u67d0\u4e2a\u7ebf\u7a0b\u518d\u6b21\u5f97\u5230\u9501\uff0c\u90a3\u4e48\u83b7\u53d6\u8ba1\u6570\u5668\u5c31\u52a0 1\uff0c\u7136\u540e\u9501\u9700\u8981\u88ab\u91ca\u653e\u4e24\u6b21\u624d\u80fd\u83b7\u5f97\u771f\u6b63\u91ca\u653e\u3002\u8fd9\u6a21\u4eff\u4e86 synchronized \u7684\u8bed\u4e49:\u5982\u679c\u7ebf\u7a0b\u8fdb\u5165\u7531\u7ebf\u7a0b\u5df2\u7ecf\u62e5\u6709\u7684\n\u76d1\u63a7\u5668\u4fdd\u62a4\u7684 synchronized \u5757\uff0c\u5c31\u5141\u8bb8\u7ebf\u7a0b\u7ee7\u7eed\u8fdb\u884c\uff0c\u5f53\u7ebf\u7a0b\u9000\u51fa\u7b2c\u4e8c\u4e2a\uff08\u6216\u8005\u540e\u7eed\uff09\nsynchronized \u5757\u7684\u65f6\u5019\uff0c\u4e0d\u91ca\u653e\u9501\uff0c\u53ea\u6709\u7ebf\u7a0b\u9000\u51fa\u5b83\u8fdb\u5165\u7684\u76d1\u63a7\u5668\u4fdd\u62a4\u7684\u7b2c\u4e00\u4e2a synchronized \u5757\u65f6\uff0c\u624d\u91ca\u653e\u9501\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u770b\u4e0b\u9762\u8fd9\u6bb5\u4ee3\u7801\u5c31\u660e\u767d\u4e86:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"class MyClass {\n    public synchronized void method1() {\n        method2();\n    }\n     \n    public synchronized void method2() {\n         \n    }\n}\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u4e0a\u8ff0\u4ee3\u7801\u4e2d\u7684\u4e24\u4e2a\u65b9\u6cd5 method1 \u548c method2 \u90fd\u7528 synchronized \u4fee\u9970\u4e86\uff0c\u5047\u5982\u67d0\u4e00\u65f6\u523b\uff0c\u7ebf\u7a0b A \u6267\u884c\u5230\u4e86 method1\uff0c\u6b64\u65f6\u7ebf\u7a0b A \u83b7\u53d6\u4e86\u8fd9\u4e2a\u5bf9\u8c61\u7684\u9501\uff0c\u800c\u7531\u4e8e method2 \u4e5f\u662f synchronized\n\u65b9\u6cd5\uff0c\u5047\u5982 synchronized \u4e0d\u5177\u5907\u53ef\u91cd\u5165\u6027\uff0c\u6b64\u65f6\u7ebf\u7a0b A \u9700\u8981\u91cd\u65b0\u7533\u8bf7\u9501\u3002\u4f46\u662f\u8fd9\u5c31\u4f1a\u9020\u6210\u4e00\u4e2a\n\u95ee\u9898\uff0c\u56e0\u4e3a\u7ebf\u7a0b A \u5df2\u7ecf\u6301\u6709\u4e86\u8be5\u5bf9\u8c61\u7684\u9501\uff0c\u800c\u53c8\u5728\u7533\u8bf7\u83b7\u53d6\u8be5\u5bf9\u8c61\u7684\u9501\uff0c\u8fd9\u6837\u5c31\u4f1a\u7ebf\u7a0b A \u4e00\u76f4\u7b49\u5f85\n\u6c38\u8fdc\u4e0d\u4f1a\u83b7\u53d6\u5230\u7684\u9501\u3002\u800c\u7531\u4e8e synchronized \u548c Lock \u90fd\u5177\u5907\u53ef\u91cd\u5165\u6027\uff0c\u6240\u4ee5\u4e0d\u4f1a\u53d1\u751f\u4e0a\u8ff0\u73b0\u8c61\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u53ef\u4e2d\u65ad\u9501",children:"\u53ef\u4e2d\u65ad\u9501"}),"\n",(0,r.jsx)(e.p,{children:"\u53ef\u4e2d\u65ad\u9501:\u5373\u53ef\u4ee5\u4e2d\u65ad\u7684\u9501\u3002\n\u5728 Java \u4e2d\uff0csynchronized \u5c31\u4e0d\u662f\u53ef\u4e2d\u65ad\u9501\uff0c\u800c Lock \u662f\u53ef\u4e2d\u65ad\u9501\u3002\n\u5982\u679c\u67d0\u4e00\u7ebf\u7a0b A \u6b63\u5728\u6267\u884c\u9501\u4e2d\u7684\u4ee3\u7801\uff0c\u53e6\u4e00\u7ebf\u7a0b B \u6b63\u5728\u7b49\u5f85\u83b7\u53d6\u8be5\u9501\uff0c\u53ef\u80fd\u7531\u4e8e\u7b49\u5f85\u65f6\u95f4\u8fc7\u957f\uff0c\u7ebf\u7a0b B \u4e0d\u60f3\u7b49\u5f85\u4e86\uff0c\u60f3\u5148\u5904\u7406\u5176\u4ed6\u4e8b\u60c5\uff0c\u6211\u4eec\u53ef\u4ee5\u8ba9\u5b83\u4e2d\u65ad\u81ea\u5df1\u6216\u8005\u5728\u522b\u7684\u7ebf\u7a0b\u4e2d\u4e2d\u65ad\u5b83\uff0c\u8fd9\u79cd\u5c31\u662f\u53ef\u4e2d\n\u65ad\u9501\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u516c\u5e73\u9501",children:"\u516c\u5e73\u9501"}),"\n",(0,r.jsx)(e.p,{children:"\u516c\u5e73\u9501\u5373\u5c3d\u91cf\u4ee5\u8bf7\u6c42\u9501\u7684\u987a\u5e8f\u6765\u83b7\u53d6\u9501\u3002\u6bd4\u5982\u540c\u662f\u6709\u591a\u4e2a\u7ebf\u7a0b\u5728\u7b49\u5f85\u4e00\u4e2a\u9501\uff0c\u5f53\u8fd9\u4e2a\u9501\u88ab\u91ca\u653e\u65f6\uff0c\u7b49\u5f85\u65f6\u95f4\u6700\u4e45\u7684\u7ebf\u7a0b\uff08\u6700\u5148\u8bf7\u6c42\u7684\u7ebf\u7a0b\uff09\u4f1a\u83b7\u5f97\u8be5\u6240\uff0c\u8fd9\u79cd\u5c31\u662f\u516c\u5e73\u9501\u3002\n\u975e\u516c\u5e73\u9501\u5373\u65e0\u6cd5\u4fdd\u8bc1\u9501\u7684\u83b7\u53d6\u662f\u6309\u7167\u8bf7\u6c42\u9501\u7684\u987a\u5e8f\u8fdb\u884c\u7684\u3002\u8fd9\u6837\u5c31\u53ef\u80fd\u5bfc\u81f4\u67d0\u4e2a\u6216\u8005\u4e00\u4e9b\u7ebf\u7a0b\u6c38\u8fdc\u83b7\u53d6\u4e0d\u5230\u9501\u3002\n\u5728 Java \u4e2d\uff0csynchronized \u5c31\u662f\u975e\u516c\u5e73\u9501\uff0c\u5b83\u65e0\u6cd5\u4fdd\u8bc1\u7b49\u5f85\u7684\u7ebf\u7a0b\u83b7\u53d6\u9501\u7684\u987a\u5e8f\u3002\n\u800c\u5bf9\u4e8e ReentrantLock \u548c ReentrantReadWriteLock\uff0c\u5b83\u9ed8\u8ba4\u60c5\u51b5\u4e0b\u662f\u975e\u516c\u5e73\u9501\uff0c\u4f46\u662f\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\n\u516c\u5e73\u9501\u3002\n\u770b\u4e00\u4e0b\u8fd9 2 \u4e2a\u7c7b\u7684\u6e90\u4ee3\u7801\u5c31\u6e05\u695a\u4e86:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"/**\n* Sync object for non-fair locks\n*/\nstatic final class NonfairSync extends Sync {\n\tprivate static final long serialVersionUID = 7316153563782823691L;\n\n\t/**\n    * Performs lock.  Try immediate barge, backing up to normal\n    * acquire on failure.\n    */\n    final void lock() {\n    \tif (compareAndSetState(0, 1))\n    \t\tsetExclusiveOwnerThread(Thread.currentThread());\n        else\n        \tacquire(1);\n    }\n\n\tprotected final boolean tryAcquire(int acquires) {\n    \treturn nonfairTryAcquire(acquires);\n    }\n}\n"})}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'/**\n* Sync object for fair locks\n*/\nstatic final class FairSync extends Sync {\n\tprivate static final long serialVersionUID = -3000897897090466540L;\n\n\tfinal void lock() {\n    \tacquire(1);\n    }\n\n    /**\n    * Fair version of tryAcquire.  Don\'t grant access unless\n    * recursive call or no waiters or is first.\n    */\n    protected final boolean tryAcquire(int acquires) {\n    \tfinal Thread current = Thread.currentThread();\n        int c = getState();\n        if (c == 0) {\n        \tif (!hasQueuedPredecessors() &&\n            \tcompareAndSetState(0, acquires)) {\n                setExclusiveOwnerThread(current);\n                return true;\n            }\n        } else if (current == getExclusiveOwnerThread()) {\n        \tint nextc = c + acquires;\n            if (nextc < 0)\n                throw new Error("Maximum lock count exceeded");\n                setState(nextc);\n                return true;\n            }\n            return false;\n        }\n    }\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u5728 ReentrantLock \u4e2d\u5b9a\u4e49\u4e86 2 \u4e2a\u9759\u6001\u5185\u90e8\u7c7b\uff0c\u4e00\u4e2a\u662f NotFairSync\uff0c\u4e00\u4e2a\u662f FairSync\uff0c\u5206\u522b\u7528\u6765\u5b9e\u73b0\u975e\u516c\u5e73\u9501\u548c\u516c\u5e73\u9501\u3002\n\u6211\u4eec\u53ef\u4ee5\u5728\u521b\u5efa ReentrantLock \u5bf9\u8c61\u65f6\uff0c\u901a\u8fc7\u4ee5\u4e0b\u65b9\u5f0f\u6765\u8bbe\u7f6e\u9501\u7684\u516c\u5e73\u6027:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"ReentrantLock lock = new ReentrantLock(true);\n"})}),"\n",(0,r.jsx)(e.p,{children:"\u5982\u679c\u53c2\u6570\u4e3a true \u8868\u793a\u4e3a\u516c\u5e73\u9501\uff0c\u4e3a fasle \u4e3a\u975e\u516c\u5e73\u9501\u3002\u9ed8\u8ba4\u60c5\u51b5\u4e0b\uff0c\u5982\u679c\u4f7f\u7528\u65e0\u53c2\u6784\u9020\u5668\uff0c\u5219\u662f\u975e\u516c\u5e73\u9501\u3002"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:"/**\n* Creates an instance of {@code ReentrantLock}.\n* This is equivalent to using {@code ReentrantLock(false)}.\n*/\npublic ReentrantLock() {\n\tsync = new NonfairSync();\n}\n\n/**\n* Creates an instance of {@code ReentrantLock} with the\n* given fairness policy.\n*\n* @param fair {@code true} if this lock should use a fair ordering policy\n*/\npublic ReentrantLock(boolean fair) {\n\tsync = fair ? new FairSync() : new NonfairSync();\n}\n"})}),"\n",(0,r.jsxs)(e.p,{children:["\u5728 ReentrantLock \u7c7b\u4e2d\u5b9a\u4e49\u4e86\u5f88\u591a\u5176\u4ed6\u65b9\u6cd5\uff0c\u6bd4\u5982:\n\u3000\u3000isFair()        //\u5224\u65ad\u9501\u662f\u5426\u662f\u516c\u5e73\u9501\n\u3000\u3000isLocked()    //\u5224\u65ad\u9501\u662f\u5426\u88ab\u4efb\u4f55\u7ebf\u7a0b\u83b7\u53d6\u4e86\n\u3000\u3000isHeldByCurrentThread()   //\u5224\u65ad\u9501\u662f\u5426\u88ab\u5f53\u524d\u7ebf\u7a0b\u83b7\u53d6\u4e86\n\u3000\u3000hasQueuedThreads()   //\u5224\u65ad\u662f\u5426\u6709\u7ebf\u7a0b\u5728\u7b49\u5f85\u8be5\u9501\n\u3000\u3000\u5728 ReentrantReadWriteLock \u4e2d\u4e5f\u6709\u7c7b\u4f3c\u7684\u65b9\u6cd5\uff0c\u540c\u6837\u4e5f\u53ef\u4ee5\u8bbe\u7f6e\u4e3a\u516c\u5e73\u9501\u548c\u975e\u516c\u5e73\u9501\u3002",(0,r.jsx)(e.strong,{children:"ReentrantReadWriteLock \u5e76\u672a\u5b9e\u73b0 Lock \u63a5\u53e3\uff0c\u5b83\u5b9e\u73b0\u7684\u662f ReadWriteLock \u63a5\u53e3\u3002"})]}),"\n",(0,r.jsx)(e.h3,{id:"\u8bfb\u5199\u9501",children:"\u8bfb\u5199\u9501"}),"\n",(0,r.jsx)(e.p,{children:"\u8bfb\u5199\u9501\u5c06\u5bf9\u4e00\u4e2a\u8d44\u6e90\uff08\u6bd4\u5982\u6587\u4ef6\uff09\u7684\u8bbf\u95ee\u5206\u6210\u4e86 2 \u4e2a\u9501\uff0c\u4e00\u4e2a\u8bfb\u9501\u548c\u4e00\u4e2a\u5199\u9501\uff0c\u4f7f\u5f97\u591a\u4e2a\u7ebf\u7a0b\u4e4b\u95f4\u7684\u8bfb\u64cd\u4f5c\u4e0d\u4f1a\u53d1\u751f\u51b2\u7a81\u3002\nReadWriteLock \u63a5\u53e3\u5c31\u662f\u8bfb\u5199\u9501\uff0cReentrantReadWriteLock \u5b9e\u73b0\u4e86\u8fd9\u4e2a\u63a5\u53e3\u3002\n\u53ef\u4ee5\u901a\u8fc7 readLock()\u83b7\u53d6\u8bfb\u9501\uff0c\u901a\u8fc7 writeLock()\u83b7\u53d6\u5199\u9501\u3002"}),"\n",(0,r.jsx)(e.h2,{id:"\u6b7b\u9501",children:"\u6b7b\u9501"}),"\n",(0,r.jsx)(e.p,{children:"\u6b7b\u9501:\u662f\u6307\u4e24\u4e2a\u6216\u4e24\u4e2a\u4ee5\u4e0a\u7684\u8fdb\u7a0b\u5728\u6267\u884c\u8fc7\u7a0b\u4e2d\uff0c\u56e0\u4e89\u593a\u8d44\u6e90\u800c\u9020\u6210\u7684\u4e00\u79cd\u4e92\u76f8\u7b49\u5f85\u7684\u73b0\u8c61\uff0c\u82e5\u65e0\u5916\u529b\u4f5c\u7528\uff0c\u5b83\u4eec\u90fd\u5c06\u65e0\u6cd5\u63a8\u8fdb\u4e0b\u53bb\u3002\u6b64\u65f6\u79f0\u7cfb\u7edf\u5904\u4e8e\u6b7b\u9501\u72b6\u6001\u6216\u7cfb\u7edf\u4ea7\u751f\u4e86\u6b7b\u9501\uff0c\u8fd9\u4e9b\u6c38\u8fdc\u5728\u4e92\u76f8\u7b49\u5f85\u7684\u8fdb\u7a0b\u79f0\u4e3a\u6b7b\u9501\u8fdb\u7a0b\u3002\u7531\u4e8e\u8d44\u6e90\u5360\u7528\u662f\u4e92\u65a5\u7684\uff0c\u5f53\u67d0\u4e2a\u8fdb\u7a0b\u63d0\u51fa\u7533\u8bf7\u8d44\u6e90\u540e\uff0c\u4f7f\u5f97\u6709\u5173\u8fdb\u7a0b\u5728\u65e0\u5916\u529b\u534f\u52a9\u4e0b\uff0c\u6c38\u8fdc\u5206\u914d\u4e0d\u5230\u5fc5\u9700\u7684\u8d44\u6e90\u800c\u65e0\u6cd5\u7ee7\u7eed\u8fd0\u884c\uff0c\u8fd9\u5c31\u4ea7\u751f\u4e86\u4e00\u79cd\u7279\u6b8a\u73b0\u8c61\u6b7b\u9501\u3002\n\u867d\u7136\u8fdb\u7a0b\u5728\u8fd0\u884c\u8fc7\u7a0b\u4e2d\uff0c\u53ef\u80fd\u53d1\u751f\u6b7b\u9501\uff0c\u4f46\u6b7b\u9501\u7684\u53d1\u751f\u4e5f\u5fc5\u987b\u5177\u5907\u4e00\u5b9a\u7684\u6761\u4ef6\uff0c\u6b7b\u9501\u7684\u53d1\u751f\u5fc5\u987b\u5177\u5907\u4ee5\u4e0b\u56db\u4e2a\u5fc5\u8981\u6761\u4ef6\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u4e92\u65a5\u6761\u4ef6",children:"\u4e92\u65a5\u6761\u4ef6"}),"\n",(0,r.jsx)(e.p,{children:"\u6307\u8fdb\u7a0b\u5bf9\u6240\u5206\u914d\u5230\u7684\u8d44\u6e90\u8fdb\u884c\u6392\u5b83\u6027\u4f7f\u7528\uff0c\u5373\u5728\u4e00\u6bb5\u65f6\u95f4\u5185\u67d0\u8d44\u6e90\u53ea\u7531\u4e00\u4e2a\u8fdb\u7a0b\u5360\u7528\u3002\u5982\u679c\u6b64\u65f6\u8fd8\u6709\u5176\u5b83\u8fdb\u7a0b\u8bf7\u6c42\u8d44\u6e90\uff0c\u5219\u8bf7\u6c42\u8005\u53ea\u80fd\u7b49\u5f85\uff0c\u76f4\u81f3\u5360\u6709\u8d44\u6e90\u7684\u8fdb\u7a0b\u7528\u6bd5\u91ca\u653e\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u8bf7\u6c42\u548c\u4fdd\u6301\u6761\u4ef6",children:"\u8bf7\u6c42\u548c\u4fdd\u6301\u6761\u4ef6"}),"\n",(0,r.jsx)(e.p,{children:"\u6307\u8fdb\u7a0b\u5df2\u7ecf\u4fdd\u6301\u81f3\u5c11\u4e00\u4e2a\u8d44\u6e90\uff0c\u4f46\u53c8\u63d0\u51fa\u4e86\u65b0\u7684\u8d44\u6e90\u8bf7\u6c42\uff0c\u800c\u8be5\u8d44\u6e90\u5df2\u88ab\u5176\u5b83\u8fdb\u7a0b\u5360\u6709\uff0c\u6b64\u65f6\u8bf7\u6c42\u8fdb\u7a0b\u963b\u585e\uff0c\u4f46\u53c8\u5bf9\u81ea\u5df1\u5df2\u83b7\u5f97\u7684\u5176\u5b83\u8d44\u6e90\u4fdd\u6301\u4e0d\u653e\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u4e0d\u5265\u593a\u6761\u4ef6",children:"\u4e0d\u5265\u593a\u6761\u4ef6"}),"\n",(0,r.jsx)(e.p,{children:"\u6307\u8fdb\u7a0b\u5df2\u83b7\u5f97\u7684\u8d44\u6e90\uff0c\u5728\u672a\u4f7f\u7528\u5b8c\u4e4b\u524d\uff0c\u4e0d\u80fd\u88ab\u5265\u593a\uff0c\u53ea\u80fd\u5728\u4f7f\u7528\u5b8c\u65f6\u7531\u81ea\u5df1\u91ca\u653e\u3002"}),"\n",(0,r.jsx)(e.h3,{id:"\u73af\u8def\u7b49\u5f85\u6761\u4ef6",children:"\u73af\u8def\u7b49\u5f85\u6761\u4ef6"}),"\n",(0,r.jsx)(e.p,{children:"\u6307\u5728\u53d1\u751f\u6b7b\u9501\u65f6\uff0c\u5fc5\u7136\u5b58\u5728\u4e00\u4e2a\u8fdb\u7a0b\u2014\u8d44\u6e90\u7684\u73af\u5f62\u94fe\uff0c\u5373\u8fdb\u7a0b\u96c6\u5408{P0\uff0cP1\uff0cP2\uff0c\xb7\xb7\xb7\uff0cPn}\u4e2d\u7684 P0 \u6b63\u5728\u7b49\u5f85\u4e00\u4e2a P1 \u5360\u7528\u7684\u8d44\u6e90\uff1bP1 \u6b63\u5728\u7b49\u5f85 P2 \u5360\u7528\u7684\u8d44\u6e90\uff0c\u2026\u2026\uff0cPn \u6b63\u5728\u7b49\u5f85\u5df2\u88ab P0 \u5360\u7528\u7684\u8d44\u6e90\u3002"}),"\n",(0,r.jsx)(e.p,{children:"\u5bf9\u8c61\u9700\u8981\u540c\u65f6\u83b7\u5f97 ObjectA \u548c ObjectB \u8d44\u6e90\u624d\u53ef\u4ee5\u8fd0\u884c\uff0c\u7f3a\u4e00\u4e0d\u53ef:"}),"\n",(0,r.jsx)(e.pre,{children:(0,r.jsx)(e.code,{className:"language-java",children:'public class DeadLock extends Thread{\n    private boolean flag;\n    private String name;\n\n    public DeadLock(boolean flag, String name) {\n        this.flag = flag;\n        this.name = name;\n    }\n\n    public void run() {\n        if (flag) {\n            synchronized (MyLock.objA) {\n                try {\n                    Thread.sleep(2000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n\n                System.out.println(name + " \u9501\u5b9a\u4e86ObjectA");\n                synchronized (MyLock.objB) {\n                    System.out.println(name + " \u9501\u5b9a\u4e86ObjectB");\n                    System.out.println(name + " \u540c\u65f6\u83b7\u5f97\u4e86ObjectA\u548cObjectB\uff0c\u5f00\u59cb\u6267\u884c");\n                }\n            }\n            System.out.println(name + " \u6267\u884c\u5b8c\u6bd5\uff0c\u91ca\u653eObjectA\u548cObjectB\u4e0a\u7684\u9501");\n        } else {\n            synchronized (MyLock.objB) {\n                try {\n                    Thread.sleep(2000);\n                } catch (InterruptedException e) {\n                    e.printStackTrace();\n                }\n\n                System.out.println(name + " \u9501\u5b9a\u4e86ObjectB");\n                synchronized (MyLock.objA) {\n                    System.out.println(name + " \u9501\u5b9a\u4e86ObjectA");\n                }\n                System.out.println(name + " \u540c\u65f6\u83b7\u5f97\u4e86ObjectB\u548cObjectA\uff0c\u5f00\u59cb\u6267\u884c");\n            }\n            System.out.println(name + " \u6267\u884c\u5b8c\u6bd5\uff0c\u91ca\u653eObjectB\u548cObjectA\u4e0a\u7684\u9501");\n        }\n    }\n\n    public static void main(String[] args) {\n        DeadLock lock1 = new DeadLock(true, "A");\n        DeadLock lock2 = new DeadLock(false, "B");\n\n        lock1.start();\n        lock2.start();\n    }\n}\n\nclass MyLock {\n    // \u521b\u5efa2\u4e2a\u9501\u5bf9\u8c61\n    public static final Object objA = new Object();\n    public static final Object objB = new Object();\n}\n'})}),"\n",(0,r.jsx)(e.p,{children:"\u7ed3\u679c:"}),"\n",(0,r.jsx)(e.p,{children:(0,r.jsx)(e.img,{alt:"1",src:t(57117).A+"",width:"666",height:"244"})}),"\n",(0,r.jsx)(e.p,{children:"A\uff0cB \u5bf9\u8c61\u9501\u5b9a\u4e86 ObjectB\uff0cA \u548c B \u90fd\u4e0d\u80fd\u540c\u65f6\u83b7\u5f97 ObjectA \u548c ObjectB\uff0c\u90fd\u5728\u7b49\u5f85\u5bf9\u65b9\u91ca\u653e\u9501\u8d44\u6e90\uff0c\u9020\u6210\u4e86\u6b7b\u9501"})]})}function u(n={}){const{wrapper:e}={...(0,a.R)(),...n.components};return e?(0,r.jsx)(e,{...n,children:(0,r.jsx)(s,{...n})}):s(n)}},28453:(n,e,t)=>{t.d(e,{R:()=>c,x:()=>o});var i=t(96540);const r={},a=i.createContext(r);function c(n){const e=i.useContext(a);return i.useMemo((function(){return"function"==typeof n?n(e):{...e,...n}}),[e,n])}function o(n){let e;return e=n.disableParentContext?"function"==typeof n.components?n.components(r):n.components||r:c(n.components),i.createElement(a.Provider,{value:e},n.children)}},57117:(n,e,t)=>{t.d(e,{A:()=>i});const i=t.p+"assets/images/1-f4a4103794fe958f02b5b82c1d6160d9.png"}}]);